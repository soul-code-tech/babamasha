<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>История дня - Бабушкины истории</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Caveat', cursive;
      background: #0a0a1a url('assets/images/old-room.jpg') no-repeat center center fixed;
      background-size: cover;
      color: #e0d4f7;
      text-align: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(30, 15, 0, 0.85);
      z-index: -1;
    }

    /* Эффект мерцающих звезд в фоне */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: white;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 1; }
    }

    .page {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.8s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      max-width: 900px;
      margin: 25px auto;
      padding: 30px;
      background: rgba(40, 15, 70, 0.8);
      border: 1px solid #9c27b0;
      border-radius: 25px;
      box-shadow: 0 0 35px rgba(156, 39, 176, 0.5);
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
    }

    .container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
    }

    h1 {
      font-family: 'Playfair Display', serif;
      color: #e1bee7;
      font-size: 2.6em;
      text-shadow: 0 0 12px #9c27b0, 0 0 20px rgba(156, 39, 176, 0.6);
      margin-bottom: 25px;
      position: relative;
      letter-spacing: 1px;
    }

    h1::after {
      content: '';
      display: block;
      width: 100px;
      height: 3px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
      margin: 15px auto;
    }

    .subtitle {
      font-size: 1.4em;
      color: #f3e5f5;
      margin-bottom: 25px;
      font-style: italic;
    }

    .date-info {
      background: rgba(50, 20, 80, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 15px;
      padding: 10px 20px;
      display: inline-block;
      margin-bottom: 25px;
      color: #e1bee7;
      font-size: 1.2em;
    }

    .submenu {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 15px;
      margin: 25px 0;
    }

    .submenu-item {
      background: rgba(50, 20, 80, 0.6);
      border: 2px solid #9c27b0;
      border-radius: 20px;
      padding: 15px 25px;
      cursor: pointer;
      transition: all 0.4s ease;
      font-size: 1.3em;
      min-width: 200px;
    }

    .submenu-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 20px rgba(156, 39, 176, 0.5);
      background: rgba(60, 30, 90, 0.8);
    }

    .submenu-item.active {
      background: rgba(60, 30, 90, 0.9);
      border-color: #e1bee7;
      box-shadow: 0 0 25px rgba(225, 190, 231, 0.7);
      font-weight: bold;
    }

    .submenu-item.locked {
      background: rgba(30, 15, 40, 0.6);
      border-color: #616161;
      color: #757575;
      cursor: not-allowed;
    }

    .submenu-item.locked:hover {
      transform: none;
      box-shadow: none;
    }

    .story-content {
      background: rgba(30, 10, 60, 0.7);
      border: 1px solid #9c27b0;
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      min-height: 400px;
      box-shadow: inset 0 0 15px rgba(156, 39, 176, 0.3);
      position: relative;
      overflow: hidden;
    }

    .story-title {
      font-family: 'Playfair Display', serif;
      color: #e1bee7;
      font-size: 2.2em;
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(225, 190, 231, 0.5);
    }

    .story-text {
      color: #f3e5f5;
      line-height: 1.6;
      font-size: 1.2em;
      text-align: justify;
      margin-bottom: 20px;
    }

    .story-image {
      width: 100%;
      max-width: 400px;
      height: auto;
      border-radius: 10px;
      margin: 15px auto;
      display: block;
      border: 2px solid #9c27b0;
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
    }

    .choices {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin: 25px 0;
    }

    @media (max-width: 768px) {
      .choices {
        grid-template-columns: 1fr;
      }
    }

    .choice-btn {
      background: linear-gradient(135deg, #9c27b0, #7b1fa2);
      color: white;
      border: none;
      padding: 15px;
      font-size: 1.2em;
      font-family: 'Caveat', cursive;
      cursor: pointer;
      border-radius: 15px;
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      z-index: 1;
    }

    .choice-btn::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: 0.6s;
      z-index: -1;
    }

    .choice-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 20px rgba(156, 39, 176, 0.7);
    }

    .choice-btn:hover::before {
      left: 100%;
    }

    .archive-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 20px;
      margin: 25px 0;
    }

    @media (max-width: 768px) {
      .archive-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (max-width: 480px) {
      .archive-grid {
        grid-template-columns: 1fr;
      }
    }

    .archive-item {
      background: rgba(50, 20, 80, 0.6);
      border: 1px solid #9c27b0;
      border-radius: 15px;
      padding: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .archive-item:hover {
      transform: translateY(-5px);
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
      background: rgba(60, 30, 90, 0.8);
    }

    .archive-title {
      font-family: 'Playfair Display', serif;
      color: #e1bee7;
      font-size: 1.4em;
      margin-bottom: 10px;
      text-shadow: 0 0 5px rgba(225, 190, 231, 0.3);
    }

    .archive-date {
      color: #f3e5f5;
      font-size: 0.9em;
      margin-bottom: 10px;
    }

    .archive-preview {
      color: #d1c4e9;
      font-size: 0.95em;
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      height: 60px;
    }

    .spell-content {
      background: rgba(30, 10, 60, 0.7);
      border: 1px solid #9c27b0;
      border-radius: 20px;
      padding: 25px;
      margin: 25px 0;
      min-height: 300px;
      box-shadow: inset 0 0 15px rgba(156, 39, 176, 0.3);
    }

    .spell-title {
      font-family: 'Playfair Display', serif;
      color: #e1bee7;
      font-size: 2.2em;
      margin-bottom: 15px;
      text-shadow: 0 0 10px rgba(225, 190, 231, 0.5);
    }

    .spell-text {
      color: #f3e5f5;
      line-height: 1.8;
      font-size: 1.3em;
      text-align: center;
      font-style: italic;
      margin-bottom: 20px;
    }

    .spell-desc {
      color: #d1c4e9;
      line-height: 1.6;
      font-size: 1.1em;
      text-align: justify;
    }

    .nav-buttons {
      margin: 30px auto 15px;
      display: flex;
      justify-content: space-between;
      max-width: 550px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .btn-back, .btn-home, .btn-next, .btn-prev {
      display: inline-block;
      padding: 12px 20px;
      background: rgba(225, 190, 231, 0.25);
      color: #e1bee7;
      text-decoration: none;
      border: 1px solid #e1bee7;
      border-radius: 12px;
      font-size: 1.1em;
      font-family: 'Caveat', cursive;
      transition: all 0.35s ease;
      box-shadow: 0 0 10px rgba(225, 190, 231, 0.3);
      min-width: 140px;
    }

    .btn-back:hover, .btn-home:hover, .btn-next:hover, .btn-prev:hover {
      background: rgba(225, 190, 231, 0.45);
      transform: scale(1.05);
      box-shadow: 0 0 15px rgba(225, 190, 231, 0.5);
    }

    .spiral {
      position: absolute;
      top: 10px;
      right: 10px;
      width: 50px;
      height: 50px;
      background: 
        radial-gradient(circle at 25px 25px, transparent 2px, #9c27b0 3px, transparent 4px),
        linear-gradient(45deg, transparent 24px, #9c27b0 25px, #9c27b0 26px, transparent 27px),
        linear-gradient(135deg, transparent 24px, #9c27b0 25px, #9c27b0 26px, transparent 27px);
      opacity: 0.3;
    }

    .seal {
      position: absolute;
      bottom: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
      background: radial-gradient(circle, #9c27b0, #4a148c);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.8em;
      opacity: 0.7;
    }

    .spell-link {
      display: inline-block;
      background: linear-gradient(135deg, #9c27b0, #7b1fa2);
      color: white;
      padding: 10px 20px;
      border-radius: 25px;
      margin-top: 20px;
      font-size: 1.2em;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.5);
    }

    .spell-link:hover {
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(156, 39, 176, 0.7);
    }

    .page-transition {
      animation: pageSlide 0.5s ease;
    }

    @keyframes pageSlide {
      from { opacity: 0; transform: translateX(20px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .story-animation {
      animation: storyAppear 0.8s ease;
    }

    @keyframes storyAppear {
      0% { opacity: 0; transform: scale(0.9); }
      100% { opacity: 1; transform: scale(1); }
    }

    .loading {
      display: none;
      text-align: center;
      padding: 20px;
    }

    .spinner {
      border: 4px solid rgba(156, 39, 176, 0.3);
      border-radius: 50%;
      border-top: 4px solid #9c27b0;
      width: 40px;
      height: 40px;
      animation: spin 1s linear infinite;
      margin: 0 auto 15px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-message {
      background: rgba(50, 20, 80, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 15px;
      padding: 20px;
      margin: 20px 0;
      color: #e1bee7;
      font-size: 1.2em;
    }

    .spell-locked {
      opacity: 0.6;
      pointer-events: none;
    }

    .spell-locked::after {
      content: '🔒';
      position: absolute;
      top: 10px;
      right: 10px;
      font-size: 1.2em;
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  
  <div class="page">
    <div class="container">
      <h1>📖 История дня</h1>
      <p class="subtitle">Мистические истории от бабы Маши</p>
      
      <div class="date-info" id="current-date">13 августа 2025</div>
      
      <div class="submenu">
        <div class="submenu-item active" onclick="showSection('story-of-day')">Бабушкина история дня</div>
        <div class="submenu-item" onclick="showSection('archive')">Архив историй</div>
        <div class="submenu-item" onclick="showSection('spells')">Заговоры бабы Маши</div>
      </div>
      
      <!-- Инструкция для пользователя -->
      <div class="empty-message" id="instructions">
        <p>Добро пожаловать в мир бабушкиных историй!</p>
        <p>Как пользоваться:</p>
        <ol style="text-align: left; margin: 15px 20px; line-height: 1.6;">
          <li>Начните с раздела "Бабушкина история дня"</li>
          <li>Прочитайте историю и сделайте два выбора (по 3 варианта на каждом этапе)</li>
          <li>В конце истории вы увидите заговор, который советует баба Маша</li>
          <li>После завершения история автоматически перейдет в архив</li>
          <li>Заговор станет доступен в разделе "Заговоры бабы Маши"</li>
          <li>В архиве вы можете открывать прочитанные истории и выбирать разные исходы</li>
        </ol>
        <p>Всего в нашей коллекции 300 уникальных историй, которые обновляются ежедневно!</p>
      </div>
      
      <!-- Секция "Бабушкина история дня" -->
      <div id="story-of-day" class="section-content" style="display: none;">
        <div class="loading" id="story-loading">
          <div class="spinner"></div>
          <p>Бабушка Маша готовит для вас историю...</p>
        </div>
        
        <div class="story-content story-animation" id="story-main-content" style="display: none;">
          <div class="spiral"></div>
          <div class="seal">БМ</div>
          
          <h2 class="story-title" id="story-title">Тайна старого колодца</h2>
          
          <img src="https://placehold.co/400x250/4a148c/9c27b0?text=Старый+колодец" alt="Старый колодец" class="story-image">
          
          <p class="story-text" id="story-text">В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец. Ему было не меньше ста лет, а может, и больше. Местные жители давно перестали его использовать, ведь рядом с колодцем появился новый водопровод. Но бабушка Агния, самая старая жительница деревни, каждый вечер подходила к колодцу и что-то шептала, бросая в темную бездну горсть пшена.</p>
          
          <p class="story-text">Однажды, в полнолуние, маленькая девочка по имени Лиза, гуляя по лесу, набрела на этот колодец. Она никогда не слышала о нем от своих родителей, которые переехали в Заречье всего год назад. Девочка подошла ближе и заглянула в темноту. Вдруг из глубины донесся странный звук — словно кто-то играл на старой гармони.</p>
          
          <p class="story-text">Лиза испугалась и хотела убежать, но что-то удержало ее. Она вспомнила, как видела бабушку Агнию у колодца и решила подождать. Вечером, когда солнце уже клонилось к закату, к колодцу пришла пожилая женщина. Она была одета в простое платье, а на голове повязан платок. Это и была бабушка Агния.</p>
          
          <p class="story-text">— Ты что тут делаешь, девочка? — спросила она, заметив Лизу.</p>
          
          <p class="story-text">— Я услышала музыку из колодца, — ответила Лиза, дрожа от страха.</p>
          
          <p class="story-text">Бабушка Агния вздохнула и подошла ближе.</p>
          
          <p class="story-text">— Это не просто колодец, — сказала она. — Здесь живет дух воды. Много лет назад, когда в деревне началась засуха, дух явился одному крестьянину во сне и показал место, где нужно вырыть колодец. С тех пор вода здесь никогда не иссякала.</p>
          
          <p class="story-text">— А почему теперь никто не пользуется колодцем? — спросила Лиза.</p>
          
          <p class="story-text">— Потому что люди перестали верить, — ответила бабушка. — Они думают, что это просто вода из-под земли. Но дух обиделся и теперь редко показывается людям.</p>
          
          <p class="story-text">В этот момент из колодца снова раздалась музыка. На этот раз Лиза услышала не только гармонь, но и тихий женский голос, напевающий старинную песню.</p>
          
          <p class="story-text">— Что мне делать? — спросила Лиза.</p>
          
          <p class="story-text">— Выбери свой путь:</p>
        </div>
        
        <div class="choices" id="story-choices" style="display: none;">
          <button class="choice-btn" onclick="choosePath(1)">Помочь духу воды вернуть доверие людей</button>
          <button class="choice-btn" onclick="choosePath(2)">Рассказать всем о колодце и духе</button>
          <button class="choice-btn" onclick="choosePath(3)">Остаться с бабушкой Агнией и учиться общаться с духами</button>
        </div>
      </div>
      
      <!-- Секция "Архив историй" -->
      <div id="archive" class="section-content" style="display: none;">
        <div class="loading" id="archive-loading">
          <div class="spinner"></div>
          <p>Бабушка Маша ищет нужную историю...</p>
        </div>
        
        <div id="archive-content" style="display: none;">
          <h2 class="story-title">Архив бабушкиных историй</h2>
          <p class="story-text" style="margin-bottom: 20px;">В архиве собраны все истории, которые вы уже прочитали. Вы можете выбрать любую историю и пережить ее заново, выбрав другой путь.</p>
          
          <div class="empty-message" id="archive-empty" style="display: none;">
            <p>Пока что вы не прочитали ни одной истории.</p>
            <p>Начните с раздела "Бабушкина история дня", чтобы добавить истории в архив.</p>
          </div>
          
          <div class="archive-grid" id="archive-grid">
            <!-- Сюда будут загружаться истории из архива -->
          </div>
          
          <div class="nav-buttons" id="archive-pagination" style="display: none;">
            <button class="btn-back" onclick="prevPage()">⬅️ Назад</button>
            <span id="page-info">Страница 1 из 30</span>
            <button class="btn-next" onclick="nextPage()">Вперёд ➡️</button>
          </div>
        </div>
      </div>
      
      <!-- Секция "Заговоры бабы Маши" -->
      <div id="spells" class="section-content" style="display: none;">
        <h2 class="story-title">Заговоры бабы Маши</h2>
        <p class="story-text" style="margin-bottom: 20px;">Мощные заговоры, проверенные временем и переданные из поколения в поколение. Доступные заговоры появляются после прочтения соответствующих историй.</p>
        
        <div class="empty-message" id="spells-empty" style="display: none;">
          <p>Пока что вы не открыли ни одного заговора.</p>
          <p>Прочитайте историю дня до конца, чтобы получить свой первый заговор!</p>
        </div>
        
        <div class="spell-content spell-locked" id="spell-1">
          <div class="seal" style="top: 10px; left: 10px;">1</div>
          <h3 class="spell-title">Заговор от сглаза и порчи</h3>
          <p class="spell-text">"Встану я рано, помолюсь, перекрещусь, выйду из дверей, из ворот в чисто поле. В чистом поле стоит дуб, а под дубом камень-алатырь. На камне-алатыре сидит белый голубь, а в клюве у него святая вода. Святая вода умывает, омывает, очищает от всякого зла, от сглаза, от порчи, от колдовства. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.</p>
        </div>
        
        <div class="spell-content spell-locked" id="spell-2">
          <div class="seal" style="top: 10px; left: 10px;">2</div>
          <h3 class="spell-title">Заговор на удачу в делах</h3>
          <p class="spell-text">"Как солнце встает, так и дела мои растут. Как месяц полнится, так и удача ко мне прибывает. Как звезды ярко светят, так и путь мой освещают. Да будет так. Аминь."</p>
          <p class="spell-desc">Произносить этот заговор нужно перед важным делом или в начале рабочего дня. Представляйте, как солнечный свет наполняет вас энергией и уверенностью. Можно добавить в заговор свое имя для персонального эффекта.</p>
        </div>
        
        <div class="spell-content spell-locked" id="spell-3">
          <div class="seal" style="top: 10px; left: 10px;">3</div>
          <h3 class="spell-title">Заговор на здоровье</h3>
          <p class="spell-text">"Матушка-земля, отец-небо, братья-ветры, сестры-реки, помогите, исцелите, здоровье верните. Как трава после дождя расцветает, так и я здоровьем обрасту. Как солнце светит ярко, так и силы мои крепнут. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор особенно эффективен при первых признаках недомогания. Произносить его лучше на рассвете, держа в руках траву или цветок. Можно использовать как профилактику каждую весну и осень.</p>
        </div>
        
        <div class="spell-content spell-locked" id="spell-4">
          <div class="seal" style="top: 10px; left: 10px;">4</div>
          <h3 class="spell-title">Заговор на гармонию с природой</h3>
          <p class="spell-text">"Деревья мои братья, травы мои сестры, ветер мой друг, вода моя мать. Поделитесь со мной своей мудростью, научите слышать шепот природы. Пусть моя душа будет чиста, как ручей, а сердце спокойно, как озеро в безветренный день. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор помогает установить связь с природой и ее духами. Произносить его нужно в лесу или у воды, держа в руках ветку дерева или горсть земли. Эффект усиливается в полнолуние.</p>
        </div>
        
        <div class="spell-content spell-locked" id="spell-5">
          <div class="seal" style="top: 10px; left: 10px;">5</div>
          <h3 class="spell-title">Заговор на освобождение от чар</h3>
          <p class="spell-text">"Светлый ангел, приди ко мне, сними чары, разреши узы. Как ключ к замку подходит, так и этот заговор ко мне пригодится. Как вода течет, так и чары с меня сойдут. Как огонь пылает, так и я от зла избавляюсь. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор используется для снятия негативного воздействия и колдовства. Произносить его нужно утром, держа в руках зажженную церковную свечу. После прочтения свечу следует потушить и сохранить до следующего утра.</p>
        </div>
      </div>

      <div class="nav-buttons">
        <a href="#" class="btn-back" onclick="goBack()" style="display: none;">⬅️ Назад</a>
        <a href="index.html" class="btn-home">🏠 Главное меню</a>
      </div>
    </div>
  </div>

  <script>
    // Создаем мерцающие звезды
    function createStars() {
      const starsContainer = document.getElementById('stars');
      const starCount = 100;
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        // Случайные параметры для звезд
        const size = Math.random() * 3;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 5;
        const duration = 2 + Math.random() * 5;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${posX}%`;
        star.style.top = `${posY}%`;
        star.style.animationDelay = `${delay}s`;
        star.style.animationDuration = `${duration}s`;
        
        starsContainer.appendChild(star);
      }
    }
    
    // Создаем частицы, похожие на летающие страницы
    function createPageParticles() {
      const container = document.querySelector('.container');
      
      for (let i = 0; i < 10; i++) {
        const particle = document.createElement('div');
        particle.style.position = 'absolute';
        const width = Math.random() * 20 + 10;
        const height = width * 1.5;
        particle.style.width = `${width}px`;
        particle.style.height = `${height}px`;
        particle.style.background = `rgba(225, 190, 231, ${Math.random() * 0.3 + 0.1})`;
        particle.style.border = '1px solid rgba(156, 39, 176, 0.3)';
        
        // Случайное положение
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.transform = `rotate(${Math.random() * 360}deg)`;
        
        // Анимация
        const duration = Math.random() * 20 + 10;
        const delay = Math.random() * 5;
        particle.style.animation = `floatParticle ${duration}s ${delay}s infinite linear`;
        
        container.appendChild(particle);
        
        // Добавляем анимацию для частиц
        const style = document.createElement('style');
        style.innerHTML = `
          @keyframes floatParticle {
            0% { transform: translate(0, 0) rotate(0deg); opacity: ${Math.random()}; }
            100% { transform: translate(${Math.random() * 100 - 50}px, ${Math.random() * -100}px) rotate(${Math.random() * 360}deg); opacity: ${Math.random()}; }
          }
        `;
        document.head.appendChild(style);
      }
    }
    
    // Прогресс пользователя
    let userProgress = {
      readStories: [],           // Прочитанные истории
      storyPaths: {},            // Выбранные пути для каждой истории
      availableSpells: []        // Доступные заговоры
    };
    
    // Текущая секция
    let currentSection = 'story-of-day';
    let storyStage = 1; // Этап истории
    let selectedPath = 0; // Выбранный путь
    let currentPage = 1;
    let totalPages = 30; // 30 страниц по 10 историй на странице = 300 историй
    
    // Идентификатор текущей истории дня
    let currentStoryId = 0;
    
    // Функция для отображения секции
    function showSection(section) {
      // Скрываем все секции
      document.querySelectorAll('.section-content').forEach(el => {
        el.style.display = 'none';
      });
      
      // Показываем выбранную секцию
      document.getElementById(section).style.display = 'block';
      
      // Обновляем активный пункт меню
      document.querySelectorAll('.submenu-item').forEach(el => {
        el.classList.remove('active');
      });
      event.currentTarget.classList.add('active');
      
      currentSection = section;
      
      // Проверяем состояние архива и заговоров
      checkArchiveStatus();
      checkSpellsStatus();
      
      // Если это архив, загружаем его содержимое
      if (section === 'archive') {
        loadArchive();
      }
      
      // Если это заговоры, проверяем доступность
      if (section === 'spells') {
        updateSpellsAvailability();
      }
      
      // Если это история дня и мы не на первом этапе, продолжаем историю
      if (section === 'story-of-day' && storyStage > 1) {
        continueStory();
      }
      
      // Показываем или скрываем кнопку "Назад"
      const backButton = document.querySelector('.btn-back');
      if (section === 'story-of-day' && storyStage === 1) {
        backButton.style.display = 'none';
      } else {
        backButton.style.display = 'inline-block';
      }
    }
    
    // Функция проверки состояния архива
    function checkArchiveStatus() {
      const emptyMessage = document.getElementById('archive-empty');
      if (userProgress.readStories.length === 0) {
        emptyMessage.style.display = 'block';
      } else {
        emptyMessage.style.display = 'none';
      }
    }
    
    // Функция проверки состояния заговоров
    function checkSpellsStatus() {
      const emptyMessage = document.getElementById('spells-empty');
      if (userProgress.availableSpells.length === 0) {
        emptyMessage.style.display = 'block';
      } else {
        emptyMessage.style.display = 'none';
      }
    }
    
    // Функция для выбора пути
    function choosePath(path) {
      selectedPath = path;
      
      if (storyStage === 1) {
        // Первый выбор
        storyStage = 2;
        continueStory();
      } else if (storyStage === 2) {
        // Второй выбор
        storyStage = 3;
        continueStory();
      }
    }
    
    // Функция продолжения истории
    function continueStory() {
      const storyText = document.getElementById('story-text');
      const choices = document.getElementById('story-choices');
      
      // Показываем анимацию загрузки
      document.getElementById('story-main-content').style.display = 'none';
      document.getElementById('story-loading').style.display = 'block';
      
      // Имитируем задержку для "приготовления" истории
      setTimeout(() => {
        // Скрываем загрузку
        document.getElementById('story-loading').style.display = 'none';
        document.getElementById('story-main-content').style.display = 'block';
        
        // Текст истории зависит от этапа и выбранного пути
        if (storyStage === 2) {
          if (selectedPath === 1) {
            storyText.innerHTML = `<p class="story-text">Лиза решила помочь духу воды вернуть доверие людей. Бабушка Агния одобрительно кивнула и сказала:</p>
            <p class="story-text">— Хороший выбор, девочка. Но это непросто. Люди перестали верить в чудеса, потому что сами перестали их замечать.</p>
            <p class="story-text">На следующий день Лиза собрала своих друзей и рассказала им о колодце. Сначала ребята смеялись, но когда Лиза привела их к колодцу и они услышали музыку, все замолчали.</p>
            <p class="story-text">— Что нам делать? — спросил самый смелый мальчик по имени Петя.</p>
            <p class="story-text">— Нужно вернуть колодцу его значение, — ответила Лиза. — Давайте уберем вокруг него, посадим цветы и расскажем взрослым, что это не просто колодец, а место силы.</p>
            <p class="story-text">Ребята согласились. Они убрали мусор вокруг колодца, собрали деньги на новую крышку и даже сделали скамейку. Лиза попросила бабушку Агнию научить их, как правильно общаться с духом воды.</p>
            <p class="story-text">Через неделю к колодцу начали приходить взрослые. Сначала с недоверием, потом с интересом. Бабушка Агния рассказывала им истории о том, как колодец спасал деревню от засухи, как вода из него исцеляла больных.</p>
            <p class="story-text">Вскоре колодец снова стал центром деревни. Люди приходили сюда, чтобы набрать воды, помолиться, оставить подношения духу. А по вечерам, когда солнце садилось за лес, из колодца доносилась тихая музыка, и казалось, будто сама природа радуется, что люди вновь обрели связь с ней.</p>
            <p class="story-text">Выберите дальнейшее развитие:</p>`;
            
            choices.innerHTML = `
              <button class="choice-btn" onclick="choosePath(1)">Помочь духу воды создать новый оберег для деревни</button>
              <button class="choice-btn" onclick="choosePath(2)">Узнать больше о тайнах колодца у бабушки Агнии</button>
              <button class="choice-btn" onclick="choosePath(3)">Рассказать о колодце в ближайшие деревни</button>
            `;
          } else if (selectedPath === 2) {
            storyText.innerHTML = `<p class="story-text">Лиза решила рассказать всем о колодце и духе. На следующий день она побежала в школу и стала рассказывать одноклассникам о том, что видела.</p>
            <p class="story-text">— Вы не поверите! В старом колодце живет дух воды, который играет на гармони! — воскликнула она.</p>
            <p class="story-text">Ребята засмеялись.</p>
            <p class="story-text">— Да ладно тебе, Лиза! Ты смотрела слишком много сказок! — сказал Петя, самый шумный мальчик в классе.</p>
            <p class="story-text">Но Лиза не сдавалась. Она привела одноклассников к колодцу после уроков. Все собрались вокруг, заглядывая в темную бездну.</p>
            <p class="story-text">— А где же дух? — спросила Маша, подруга Лизы.</p>
            <p class="story-text">— Подождите, — прошептала Лиза. — Он появляется только в определенное время.</p>
            <p class="story-text">Но дух не появился. Не было ни музыки, ни голоса. Только тишина и темнота. Ребята посмеялись над Лизой и ушли.</p>
            <p class="story-text">На следующий день Лиза снова пришла к колодцу. Бабушка Агния уже ждала ее.</p>
            <p class="story-text">— Не нужно спешить, девочка, — сказала она. — Духи не любят, когда их выставляют напоказ. Они появляются только тогда, когда к ним относятся с уважением и верой.</p>
            <p class="story-text">Лиза поняла, что поступила неправильно. Она решила больше никому не рассказывать о колодце, пока не научится правильно общаться с духом.</p>
            <p class="story-text">Выберите дальнейшее развитие:</p>`;
            
            choices.innerHTML = `
              <button class="choice-btn" onclick="choosePath(1)">Попросить бабушку Агнию научить общаться с духом</button>
              <button class="choice-btn" onclick="choosePath(2)">Принести цветы и пшено в качестве даров духу</button>
              <button class="choice-btn" onclick="choosePath(3)">Искать другие места силы в лесу</button>
            `;
          } else if (selectedPath === 3) {
            storyText.innerHTML = `<p class="story-text">Лиза решила остаться с бабушкой Агнией и учиться общаться с духами. Бабушка одобрительно кивнула.</p>
            <p class="story-text">— Хороший выбор, девочка, — сказала она. — Но путь этот непростой. Ты готова учиться?</p>
            <p class="story-text">— Да, — уверенно ответила Лиза.</p>
            <p class="story-text">С тех пор каждое утро Лиза приходила к бабушке Агнии. Сначала она училась чувствовать энергию природы, определять, где находится вода под землей, как разговаривать с деревьями и животными.</p>
            <p class="story-text">— Чтобы общаться с духами, нужно сначала научиться слышать тишину, — говорила бабушка. — Только когда твой внутренний мир будет спокоен, ты услышишь голоса других миров.</p>
            <p class="story-text">Через месяц Лиза впервые услышала, как деревья шепчутся между собой. Еще через неделю она научилась видеть ауры живых существ. А через два месяца дух воды из колодца сам пришел к ней во сне.</p>
            <p class="story-text">— Ты готова, — сказал он. — Теперь ты можешь стать хранителем этого места.</p>
            <p class="story-text">Лиза поняла, что выбрала свой путь. Она будет учиться у бабушки Агнии, чтобы однажды сама стать хранительницей мудрости и передать свои знания следующему поколению.</p>
            <p class="story-text">Выберите дальнейшее развитие:</p>`;
            
            choices.innerHTML = `
              <button class="choice-btn" onclick="choosePath(1)">Начать учиться целительству у бабушки Агнии</button>
              <button class="choice-btn" onclick="choosePath(2)">Искать других духов в лесу и на реке</button>
              <button class="choice-btn" onclick="choosePath(3)">Помогать людям с их проблемами, используя новые знания</button>
            `;
          }
        } else if (storyStage === 3) {
          if (selectedPath === 1) {
            storyText.innerHTML = `<p class="story-text">Лиза и ее друзья решили помочь духу воды создать новый оберег для деревни. Бабушка Агния рассказала им, что в старину обереги делали из осины, потому что эта древесина отпугивает негативную энергию.</p>
            <p class="story-text">— Но нужно соблюдать определенные правила, — предупредила она. — Оберег нужно вырезать в полнолуние, когда энергия природы наиболее сильна.</p>
            <p class="story-text">Когда наступил полный месяц, вся компания собралась в лесу. Бабушка Агния принесла с собой старинный нож, которым пользовались ее предки.</p>
            <p class="story-text">— Каждый из вас должен вырезать на обереге свой символ, — сказала она. — То, что для вас самое важное.</p>
            <p class="story-text">Лиза вырезала каплю воды, символизирующую дух колодца. Петя — солнце, Маша — цветок, остальные ребята — свои символы.</p>
            <p class="story-text">Когда оберег был готов, они принесли его к колодцу и положили на край. В ту же ночь колодец заиграл новую мелодию, более светлую и радостную.</p>
            <p class="story-text">С тех пор в деревне перестали случаться несчастья. Люди, которые брали воду из колодца, чувствовали прилив сил и ясность мысли. А те, кто проходил мимо с оберегом, отмечали, что их проблемы становились меньше.</p>
            <p class="story-text">Однажды ночью Лиза проснулась от странного ощущения. Она подошла к окну и увидела, как из колодца поднимается светящаяся фигура. Это был дух воды, который кланялся им всем.</p>
            <p class="story-text">— Спасибо, — прошептал он, и его голос звучал как журчание ручья. — Вы вернули мне веру в людей.</p>
            <p class="story-text">На следующее утро Лиза нашла у колодца маленькую статуэтку, сделанную из глины. На ней была изображена девочка с ведром воды в руках. Это был подарок от духа.</p>
            <p class="story-text">Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(1)">заговор от неприятностей</span>, который поможет сохранить гармонию с природой и защититься от негатива.</p>`;
            
            choices.style.display = 'none';
            
            // Добавляем историю в архив
            addToArchive(1, 1);
            // Добавляем заговор в доступные
            addSpellToCollection(1);
          } else if (selectedPath === 2) {
            storyText.innerHTML = `<p class="story-text">Лиза решила узнать больше о тайнах колодца у бабушки Агнии. Каждый вечер после уроков она приходила к старушке и слушала ее рассказы.</p>
            <p class="story-text">— Этот колодец был вырыт еще в 1825 году, — рассказывала бабушка. — В те времена в деревне началась страшная засуха. Поля высохли, реки мелели, люди голодали.</p>
            <p class="story-text">— Однажды ночью крестьянину Ивану приснился сон. Ему явилась женщина в белом платье и сказала: "Вырой колодец там, где три дуба растут рядом, и вода напоит всю деревню".</p>
            <p class="story-text">— Иван рассказал об этом людям, но они не поверили. Тогда он сам выкопал колодец в том месте. И когда ударил киркой по земле в третий раз, хлынула чистая ключевая вода.</p>
            <p class="story-text">— С тех пор вода в колодце никогда не иссякала. Даже в самую сильную засуху здесь всегда была вода. Люди приходили сюда, чтобы набрать воды, помолиться, оставить подношения.</p>
            <p class="story-text">— Но со временем люди перестали верить. Они думали, что это просто вода из-под земли, что духа нет. И дух обиделся, перестал показываться людям.</p>
            <p class="story-text">— А почему он начал играть на гармони? — спросила Лиза.</p>
            <p class="story-text">— Потому что он скучает, — ответила бабушка. — Духи тоже чувствуют одиночество. Им нужно, чтобы люди верили в них, общались с ними.</p>
            <p class="story-text">Лиза поняла, что нужно сделать. Она попросила бабушку научить ее, как правильно общаться с духом воды.</p>
            <p class="story-text">— Каждый вечер приходи к колодцу, — сказала бабушка. — Говори с ним, как с другом. Приносите дары — пшено, цветы, сладости. И со временем он откроется тебе.</p>
            <p class="story-text">С тех пор Лиза каждый вечер приходила к колодцу. Она рассказывала духу о своем дне, о школе, о друзьях. Иногда она пела песни, которые учила в музыкальной школе.</p>
            <p class="story-text">Через месяц дух начал отвечать ей. Сначала это были тихие звуки, похожие на журчание ручья. Потом появились мелодии. А через два месяца Лиза услышала, как дух назвал ее по имени.</p>
            <p class="story-text">Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(2)">заговор от сглаза</span>, который поможет сохранить связь с духами природы и защититься от негатива.</p>`;
            
            choices.style.display = 'none';
            
            // Добавляем историю в архив
            addToArchive(1, 2);
            // Добавляем заговор в доступные
            addSpellToCollection(2);
          } else if (selectedPath === 3) {
            storyText.innerHTML = `<p class="story-text">Лиза и ее друзья решили рассказать о колодце в ближайшие деревни. Они сделали объявления и развесили их по окрестным селам.</p>
            <p class="story-text">— Приходите к чудесному колодцу! — писали они. — Здесь живет дух воды, который исполняет желания!</p>
            <p class="story-text">Сначала пришли несколько человек из соседней деревни. Они увидели колодец, услышали музыку и рассказали об этом другим.</p>
            <p class="story-text">Вскоре к колодцу начали приезжать люди со всего района. Некоторые приносили цветы и пшено, другие просто приходили полюбоваться.</p>
            <p class="story-text">Но однажды все изменилось. Приехал человек с камерой и начал снимать репортаж для телевизора. Он громко говорил в микрофон о "народных суевериях" и "отсталости деревенских жителей".</p>
            <p class="story-text">— Это просто колодец, — заявил он. — Никаких духов здесь нет. Просто грунтовые воды.</p>
            <p class="story-text">С тех пор музыка из колодца перестала звучать. Люди разочаровались и перестали приходить.</p>
            <p class="story-text">Лиза пришла к бабушке Агнии в слезах.</p>
            <p class="story-text">— Не плачь, девочка, — сказала бабушка. — Так бывает. Духи не любят, когда их выставляют напоказ. Они появляются только тогда, когда к ним относятся с уважением и верой.</p>
            <p class="story-text">— Что же делать? — спросила Лиза.</p>
            <p class="story-text">— Нужно вернуть доверие, — ответила бабушка. — Но не всему миру, а самим себе. Начни с малого. Приходи к колодцу каждый день, разговаривай с духом, как с другом. И со временем он вернется.</p>
            <p class="story-text">Лиза последовала совету бабушки. Она приходила к колодцу каждый день, рассказывала о своем дне, пела песни. Иногда она приносила цветы или горсть пшена.</p>
            <p class="story-text">Через месяц музыка вернулась. Сначала тихо, едва слышно. Потом громче. И однажды ночью Лиза увидела, как из колодца поднимается светящаяся фигура в белом платье.</p>
            <p class="story-text">— Спасибо, что не потеряла веру, — прошептал дух. — Я буду играть только для тех, кто приходит с чистым сердцем.</p>
            <p class="story-text">Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(3)">заговор на гармонию с природой</span>, который поможет сохранить связь с духами и не потерять веру.</p>`;
            
            choices.style.display = 'none';
            
            // Добавляем историю в архив
            addToArchive(1, 3);
            // Добавляем заговор в доступные
            addSpellToCollection(3);
          }
        }
      }, 800);
    }
    
    // Функция добавления истории в архив
    function addToArchive(storyId, path) {
      // Сохраняем выбранный путь
      userProgress.storyPaths[storyId] = path;
      
      // Добавляем в архив, если еще нет
      if (!userProgress.readStories.includes(storyId)) {
        userProgress.readStories.push(storyId);
        console.log(`История ${storyId} добавлена в архив`);
      }
      
      // Проверяем состояние архива
      checkArchiveStatus();
    }
    
    // Функция добавления заговора в коллекцию
    function addSpellToCollection(spellId) {
      // Добавляем заговор, если еще нет
      if (!userProgress.availableSpells.includes(spellId)) {
        userProgress.availableSpells.push(spellId);
        console.log(`Заговор ${spellId} добавлен в коллекцию`);
        
        // Обновляем доступность заговоров
        updateSpellsAvailability();
      }
    }
    
    // Функция обновления доступности заговоров
    function updateSpellsAvailability() {
      // Скрываем инструкцию
      document.getElementById('instructions').style.display = 'none';
      
      // Обновляем все заговоры
      for (let i = 1; i <= 5; i++) {
        const spellElement = document.getElementById(`spell-${i}`);
        if (userProgress.availableSpells.includes(i)) {
          spellElement.classList.remove('spell-locked');
        } else {
          spellElement.classList.add('spell-locked');
        }
      }
    }
    
    // Функция для отображения раздела заговоров
    function showSpellsSection(spellId) {
      showSection('spells');
      
      // Прокручиваем к нужному заговору
      setTimeout(() => {
        const spellElement = document.getElementById(`spell-${spellId}`);
        if (spellElement) {
          spellElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
        }
      }, 300);
    }
    
    // Функция для загрузки архива
    function loadArchive() {
      // Показываем индикатор загрузки
      document.getElementById('archive-content').style.display = 'none';
      document.getElementById('archive-loading').style.display = 'block';
      
      // Имитируем задержку загрузки
      setTimeout(() => {
        // Скрываем индикатор загрузки
        document.getElementById('archive-loading').style.display = 'none';
        document.getElementById('archive-content').style.display = 'block';
        
        // Генерируем историй для текущей страницы
        generateArchiveStories();
        
        // Обновляем информацию о странице
        document.getElementById('page-info').textContent = `Страница ${currentPage} из ${totalPages}`;
        document.getElementById('archive-pagination').style.display = 'flex';
      }, 1000);
    }
    
    // Функция для генерации историй в архиве
    function generateArchiveStories() {
      const archiveGrid = document.getElementById('archive-grid');
      archiveGrid.innerHTML = '';
      
      // Фильтруем только прочитанные истории для текущей страницы
      const startIndex = (currentPage - 1) * 10;
      const endIndex = startIndex + 10;
      const visibleStories = userProgress.readStories.slice(startIndex, endIndex);
      
      // Если нет историй на текущей странице, переходим на предыдущую
      if (visibleStories.length === 0 && currentPage > 1) {
        currentPage--;
        generateArchiveStories();
        return;
      }
      
      // Генерируем карточки для прочитанных историй
      visibleStories.forEach(storyId => {
        const story = getArchiveStory(storyId);
        
        const storyElement = document.createElement('div');
        storyElement.className = 'archive-item';
        storyElement.onclick = function() { loadStoryFromArchive(storyId); };
        
        storyElement.innerHTML = `
          <h3 class="archive-title">${story.title}</h3>
          <div class="archive-date">${story.date}</div>
          <p class="archive-preview">${story.preview}</p>
        `;
        
        archiveGrid.appendChild(storyElement);
      });
      
      // Обновляем информацию о странице
      totalPages = Math.ceil(userProgress.readStories.length / 10) || 1;
      document.getElementById('page-info').textContent = `Страница ${currentPage} из ${totalPages}`;
      
      // Скрываем пагинацию, если всего одна страница
      if (totalPages <= 1) {
        document.getElementById('archive-pagination').style.display = 'none';
      } else {
        document.getElementById('archive-pagination').style.display = 'flex';
      }
    }
    
    // Функция для получения истории из архива
    function getArchiveStory(id) {
      // Определяем дату на основе ID
      const baseDate = new Date(2025, 7, 13); // 13 августа 2025
      const storyDate = new Date(baseDate);
      storyDate.setDate(baseDate.getDate() - id);
      
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const dateString = storyDate.toLocaleDateString('ru-RU', options);
      
      // Генерируем данные на основе ID
      const themes = [
        "Тайна старого колодца", "Лесной оберег", "Дух реки", "Ведьмин цветок", 
        "Ночь перед Рождеством", "Старая карта", "Заброшенная мельница", 
        "Тайный сад", "Дом с привидениями", "Озеро снов", "Горный перевал", 
        "Старая библиотека", "Пещера предсказаний", "Лунная поляна", "Звездная тропа"
      ];
      
      const actions = [
        "исследовала", "обнаружила", "столкнулась", "раскрыла", "помогла", 
        "спасла", "преодолела", "нашла", "расколдовала", "превратила"
      ];
      
      const endings = [
        "злой колдунье", "проклятию", "темным силам", "беде", "опасности", 
        "бедствию", "беде", "злу", "напасти", "бедствию"
      ];
      
      const themeIndex = id % themes.length;
      const actionIndex = Math.floor(id / 2) % actions.length;
      const endingIndex = Math.floor(id / 3) % endings.length;
      
      const title = `${themes[themeIndex]} №${id}`;
      const preview = `В одной маленькой деревушке под названием Заречье, затерянной среди густых лесов и полей, произошло необычное событие. Местные жители давно заметили странные явления, но только ${id % 3 === 0 ? 'маленькая девочка' : id % 3 === 1 ? 'старый дед' : 'путешественник'} решился разобраться в их причинах...`;
      
      return {
        id: id,
        title: title,
        date: dateString,
        preview: preview
      };
    }
    
    // Функция для загрузки истории из архива
    function loadStoryFromArchive(id) {
      // Показываем индикатор загрузки
      document.getElementById('story-main-content').style.display = 'none';
      document.getElementById('story-loading').style.display = 'block';
      
      // Имитируем задержку загрузки
      setTimeout(() => {
        // Скрываем индикатор загрузки
        document.getElementById('story-loading').style.display = 'none';
        document.getElementById('story-main-content').style.display = 'block';
        
        // Загружаем историю из архива
        const story = getFullArchiveStory(id);
        
        // Отображаем историю
        document.getElementById('story-title').textContent = story.title;
        document.getElementById('story-text').innerHTML = story.content;
        
        // Показываем выборы, если история не завершена
        if (userProgress.storyPaths[id] === 1 || userProgress.storyPaths[id] === 2) {
          document.getElementById('story-choices').style.display = 'grid';
        } else {
          document.getElementById('story-choices').style.display = 'none';
        }
        
        // Сбрасываем этапы истории
        storyStage = userProgress.storyPaths[id] || 1;
        selectedPath = 0;
        
        // Показываем кнопку "Назад"
        document.querySelector('.btn-back').style.display = 'inline-block';
        
        // Скрываем инструкцию
        document.getElementById('instructions').style.display = 'none';
      }, 1000);
    }
    
    // Функция для получения полной истории из архива
    function getFullArchiveStory(id) {
      // Генерируем уникальный контент
      const titles = [
        "Тайна старого колодца", "Лесной оберег", "Дух реки", "Ведьмин цветок", "Ночь перед Рождеством"
      ];
      
      const images = [
        "https://placehold.co/400x250/4a148c/9c27b0?text=Старый+колодец",
        "https://placehold.co/400x250/4a148c/9c27b0?text=Лесной+оберег",
        "https://placehold.co/400x250/4a148c/9c27b0?text=Дух+реки",
        "https://placehold.co/400x250/4a148c/9c27b0?text=Ведьмин+цветок",
        "https://placehold.co/400x250/4a148c/9c27b0?text=Рождественская+ночь"
      ];
      
      const title = titles[id % 5] + ` №${id}`;
      const image = images[id % 5];
      
      // Для демонстрации покажем подробную историю только для нескольких ID
      if (id === 1) {
        return {
          id: id,
          title: title,
          image: image,
          content: `В глухом лесу жила старая знахарка, которая умела делать обереги из осины. Однажды к ней пришел молодой человек с просьбой помочь. Его невеста тяжело заболела, и ни один врач не мог поставить диагноз. Знахарка согласилась помочь, но предупредила: "Это не простая болезнь. На твою невесту наложили порчу".<br><br>
          Молодой человек был в шоке. Он не верил в колдовство, но отчаяние заставило его согласиться на все условия знахарки. Она дала ему три задания: собрать росу с листьев осины в полнолуние, найти гнездо орла на самой высокой горе и принести воду из источника, который бьет под старым дубом.<br><br>
          Путь был нелегким. Молодой человек преодолел множество препятствий: переправлялся через бурные реки, карабкался на крутые склоны, боролся с собственными страхами. Но он не сдавался, потому что любил свою невесту.<br><br>
          Когда он вернулся к знахарке с дарами, она изготовила оберег и дала наставления: "Носи его на шее, не снимай ни днем, ни ночью. И помни: сила оберега зависит от твоей веры".<br><br>
          Молодой человек вернулся домой и повесил оберег на шею невесты. Уже на следующий день ее состояние улучшилось. Через неделю она полностью поправилась. Но самое удивительное было впереди...<br><br>
          Однажды ночью молодой человек проснулся от странного шепота. Оберег на шее невесты светился мягким светом. Из света появилась фигура женщины в белом. "Спасибо, что не потерял веру", — прошептала она и исчезла.<br><br>
          Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(1)">заговор на защиту от порчи</span>, который поможет сохранить гармонию и защититься от негатива.`
        };
      } else if (id === 2) {
        return {
          id: id,
          title: title,
          image: image,
          content: `В заброшенном замке на окраине деревни каждую полнолуние слышались странные звуки. Местные жители боялись туда ходить, считая, что замок проклят. Но маленькая девочка по имени Аня не верила в страшилки.<br><br>
          Однажды вечером, в полнолуние, Аня решила проверить, что происходит в замке. Она взяла фонарик и отправилась туда одна. По пути ей попадались странные следы на земле — будто кто-то большой ходил босыми ногами.<br><br>
          Войдя в замок, Аня увидела, что внутри он совсем не страшный. На стенах висели старинные картины, в залах стояла пыльная мебель, а в центральном зале — рояль.<br><br>
          Внезапно из-за угла появился огромный пес. Аня замерла от страха, но пес подошел и лизнул ее в руку. Оказалось, это был страж замка, превращенный в пса злой колдуньей.<br><br>
          Пес повел Аню в подвал, где она увидела маленькую девочку, запертую в клетке. Это была настоящая хозяйка замка, которую колдунья похитила много лет назад.<br><br>
          — Помоги мне, — попросила девочка. — Найди три ключа: золотой, серебряный и бронзовый. Они спрятаны в разных частях замка.<br><br>
          Аня отправилась на поиски. Золотой ключ она нашла в рояле, серебряный — в старом комоде, а бронзовый — в потайном кармане пальто, висевшего в гардеробной.<br><br>
          Когда она открыла клетку, хозяйка замка обняла ее и сказала: "Ты спасла меня. Теперь я могу вернуть замок к жизни".<br><br>
          В тот же миг замок преобразился. Пыль исчезла, картины засияли яркими красками, а сад перед замком зацвел. Девочка-хозяйка превратила пса обратно в человека — это был верный слуга ее семьи.<br><br>
          Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(2)">заговор на освобождение от чар</span>, который поможет избавиться от негативного влияния и вернуть гармонию в жизнь.`
        };
      } else {
        // Для остальных историй генерируем уникальный контент на основе ID
        const storyParts = [
          `В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, произошло необычное событие. Местные жители давно заметили странные явления, но только ${id % 3 === 0 ? 'маленькая девочка' : id % 3 === 1 ? 'старый дед' : 'путешественник'} решился разобраться в их причинах.<br><br>`,
          
          `Однажды, ${id % 2 === 0 ? 'в полнолуние' : 'на рассвете'}, ${id % 3 === 0 ? 'она' : 'он'} обнаружил${id % 3 === 0 ? '' : 'а'} место, где энергия земли была особенно сильной. Это был ${id % 4 === 0 ? 'старый дуб' : id % 4 === 1 ? 'источник' : id % 4 === 2 ? 'каменный круг' : 'древний храм'}.<br><br>`,
          
          `Подойдя ближе, ${id % 3 === 0 ? 'девочка' : id % 3 === 1 ? 'дед' : 'путешественник'} почувствовал${id % 3 === 0 ? '' : 'а'} ${id % 2 === 0 ? 'странное тепло' : 'тихий шепот'}. Внезапно из-под земли появился${id % 2 === 0 ? '' : 'ась'} дух, который рассказал${id % 3 === 0 ? '' : 'а'} о древнем проклятии, лежащем на деревне.<br><br>`,
          
          `— Чтобы снять проклятие, нужно выполнить три условия, — сказал${id % 2 === 0 ? '' : 'а'} дух. — Собери ${id % 5 === 0 ? 'цветы, которые цветут только под полной луной' : id % 5 === 1 ? 'воду из семи источников' : id % 5 === 2 ? 'листья семи разных деревьев' : id % 5 === 3 ? 'камни семи цветов' : 'травы семи времен года'}, найди ${id % 4 === 0 ? 'пещеру под горой' : id % 4 === 1 ? 'старый колодец в лесу' : id % 4 === 2 ? 'заброшенную часовню' : 'древнее дерево'} и произнеси заклинание на рассвете.<br><br>`,
          
          `${id % 3 === 0 ? 'Девочка' : id % 3 === 1 ? 'Дед' : 'Путешественник'} не испугался${id % 3 === 0 ? '' : 'ась'} и отправил${id % 3 === 0 ? 'ась' : 'ся'} в путь. По дороге пришлось преодолеть множество препятствий: ${id % 3 === 0 ? 'переправиться через бурную реку' : id % 3 === 1 ? 'пройти через густой туман' : 'преодолеть высокие горы'}, найти ${id % 2 === 0 ? 'потерянную тропу' : 'сокровище древних'} и ${id % 2 === 0 ? 'расшифровать старинные записи' : 'помочь потерявшемуся ребенку'}.<br><br>`,
          
          `Когда все условия были выполнены, ${id % 3 === 0 ? 'девочка' : id % 3 === 1 ? 'дед' : 'путешественник'} вернулся${id % 3 === 0 ? 'ась' : 'ся'} в деревню. В назначенный час, на рассвете, был произнесен${id % 2 === 0 ? '' : 'о'} древний заговор. И в тот же миг проклятие исчезло!<br><br>`,
          
          `С тех пор в деревне ${id % 2 === 0 ? 'цветут сады даже в засуху' : 'люди живут в мире и гармонии'}, а место силы стало священным. А дух, который помог${id % 3 === 0 ? '' : 'ла'} в трудную минуту, иногда появляется в полнолуние, чтобы напомнить жителям о важности веры и единства.<br><br>`,
          
          `Теперь, когда вы дошли до конца истории, вы можете прочитать <span class="spell-link" onclick="showSpellsSection(${id % 5 + 1})">заговор на гармонию с природой</span>, который поможет сохранить связь с духами и не потерять веру.`
        ];
        
        return {
          id: id,
          title: title,
          image: image,
          content: storyParts.join('')
        };
      }
    }
    
    // Функция для перехода на предыдущую страницу архива
    function prevPage() {
      if (currentPage > 1) {
        currentPage--;
        generateArchiveStories();
      }
    }
    
    // Функция для перехода на следующую страницу архива
    function nextPage() {
      if (currentPage < totalPages) {
        currentPage++;
        generateArchiveStories();
      }
    }
    
    // Функция для возврата назад
    function goBack() {
      if (currentSection === 'story-of-day' && (storyStage === 2 || storyStage === 3)) {
        // Возвращаемся к предыдущему этапу истории
        storyStage--;
        continueStory();
      } else if (currentSection === 'story-of-day' && storyStage === 1) {
        // Возвращаемся к выбору раздела
        showSection('story-of-day');
      } else {
        // Возвращаемся к истории дня
        showSection('story-of-day');
      }
      
      // Показываем кнопку "Назад" после возвращения
      document.querySelector('.btn-back').style.display = 'inline-block';
    }
    
    // Функция для установки текущей даты
    function setCurrentDate() {
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      const dateString = now.toLocaleDateString('ru-RU', options);
      
      document.getElementById('current-date').textContent = dateString;
    }
    
    // Функция для определения истории дня
    function setDailyStory() {
      // Определяем ID истории на основе текущей даты
      const baseDate = new Date(2025, 7, 13); // 13 августа 2025 - начало цикла
      const today = new Date();
      
      // Вычисляем разницу в днях
      const diffTime = Math.abs(today - baseDate);
      const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
      
      // Определяем ID истории (циклически от 1 до 300)
      currentStoryId = (diffDays % 300) + 1;
      
      // Проверяем, была ли эта история уже прочитана в текущем цикле
      const isRead = userProgress.readStories.includes(currentStoryId);
      
      // Для примера устанавливаем название истории
      const storyTitle = document.getElementById('story-title');
      storyTitle.textContent = `История дня №${currentStoryId}${isRead ? ' (уже читали)' : ''}`;
      
      // Показываем инструкцию, если это первая история
      if (userProgress.readStories.length === 0) {
        document.getElementById('instructions').style.display = 'block';
      } else {
        document.getElementById('instructions').style.display = 'none';
      }
    }
    
    // Функция для инициализации приложения
    function initApp() {
      createStars();
      createPageParticles();
      setCurrentDate();
      setDailyStory();
      
      // Показываем историю дня
      setTimeout(() => {
        document.getElementById('story-loading').style.display = 'none';
        document.getElementById('story-main-content').style.display = 'block';
        
        // Показываем кнопку "Назад", если это не первая страница
        const backButton = document.querySelector('.btn-back');
        if (storyStage === 1) {
          backButton.style.display = 'none';
        } else {
          backButton.style.display = 'inline-block';
        }
      }, 1000);
      
      // Проверяем состояние архива и заговоров
      checkArchiveStatus();
      checkSpellsStatus();
    }
    
    // Инициализация при загрузке страницы
    window.onload = initApp;
  </script>
</body>
</html>