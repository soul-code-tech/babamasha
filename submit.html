<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>Расскажи свою тайну - Бабушкины истории</title>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Caveat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-tap-highlight-color: transparent;
    }

    body {
      font-family: 'Caveat', cursive;
      background: #f5f0ff url('image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="0 0 100 100"><rect width="100" height="100" fill="%23f5f0ff"/><path d="M0,50 Q25,20 50,50 T100,50" fill="none" stroke="%237b1fa2" stroke-width="0.3" opacity="0.2"/><path d="M0,70 Q25,40 50,70 T100,70" fill="none" stroke="%237b1fa2" stroke-width="0.3" opacity="0.2"/></svg>') repeat;
      color: #311b58;
      text-align: center;
      min-height: 100vh;
      padding: 15px;
      position: relative;
      overflow: hidden;
      touch-action: manipulation;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(255, 250, 255, 0.85);
      z-index: -1;
    }

    /* Эффект мерцающих звезд в фоне */
    .stars {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star {
      position: absolute;
      background: #e1bee7;
      border-radius: 50%;
      animation: twinkle 3s infinite;
    }

    @keyframes twinkle {
      0%, 100% { opacity: 0.2; }
      50% { opacity: 0.5; }
    }

    .page {
      opacity: 0;
      transform: translateY(20px);
      animation: fadeIn 0.8s ease forwards;
    }

    @keyframes fadeIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container {
      max-width: 100%;
      margin: 15px auto;
      padding: 20px 15px;
      background: rgba(255, 250, 255, 0.92);
      border: 1px solid #9c27b0;
      border-radius: 20px;
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.2);
      position: relative;
      overflow: hidden;
    }

    .container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
    }

    .container::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
    }

    h1 {
      font-family: 'Playfair Display', serif;
      color: #7b1fa2;
      font-size: 1.9em;
      text-shadow: 0 0 5px rgba(156, 39, 176, 0.3);
      margin-bottom: 15px;
      position: relative;
      letter-spacing: 1px;
    }

    h1::after {
      content: '';
      display: block;
      width: 80px;
      height: 3px;
      background: linear-gradient(90deg, transparent, #9c27b0, transparent);
      margin: 10px auto;
    }

    .subtitle {
      font-size: 1.2em;
      color: #5e35b1;
      margin-bottom: 20px;
      font-style: italic;
      line-height: 1.4;
    }

    .submenu {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      gap: 10px;
      margin: 15px 0;
      overflow-x: auto;
      padding-bottom: 5px;
      scrollbar-width: none;
    }

    .submenu::-webkit-scrollbar {
      display: none;
    }

    .submenu-item {
      background: rgba(232, 221, 247, 0.6);
      border: 2px solid #9c27b0;
      border-radius: 18px;
      padding: 10px 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.1em;
      min-width: 120px;
      white-space: nowrap;
    }

    .submenu-item:hover {
      transform: translateY(-3px);
      box-shadow: 0 0 10px rgba(156, 39, 176, 0.3);
      background: rgba(206, 181, 237, 0.7);
    }

    .submenu-item.active {
      background: rgba(206, 181, 237, 0.9);
      border-color: #7b1fa2;
      box-shadow: 0 0 15px rgba(156, 39, 176, 0.4);
      font-weight: bold;
    }

    .section-content {
      display: none;
    }

    .profile-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }

    .avatar-container {
      position: relative;
      width: 100px;
      height: 100px;
      margin-bottom: 15px;
    }

    .avatar {
      width: 100%;
      height: 100%;
      border-radius: 50%;
      object-fit: cover;
      border: 3px solid #9c27b0;
      box-shadow: 0 0 8px rgba(156, 39, 176, 0.3);
    }

    .input-group {
      width: 100%;
      max-width: 100%;
      margin: 12px 0;
    }

    .input-label {
      display: block;
      text-align: left;
      margin-bottom: 6px;
      color: #5e35b1;
      font-weight: bold;
      font-size: 1.05em;
    }

    .input-field {
      width: 100%;
      padding: 10px;
      background: rgba(232, 221, 247, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 8px;
      color: #311b58;
      font-family: 'Caveat', cursive;
      font-size: 1.05em;
    }

    .input-field:focus {
      outline: none;
      border-color: #7b1fa2;
      box-shadow: 0 0 5px rgba(156, 39, 176, 0.2);
    }

    .textarea-field {
      min-height: 150px;
      resize: vertical;
    }

    .radio-group {
      display: flex;
      gap: 12px;
      margin: 12px 0;
      justify-content: center;
      flex-wrap: wrap;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 4px;
      flex: 1;
      min-width: 80px;
    }

    .radio-input {
      display: none;
    }

    .radio-label {
      background: rgba(232, 221, 247, 0.6);
      border: 1px solid #9c27b0;
      border-radius: 18px;
      padding: 6px 12px;
      cursor: pointer;
      transition: all 0.25s ease;
      width: 100%;
      text-align: center;
      font-size: 0.95em;
    }

    .radio-input:checked + .radio-label {
      background: #9c27b0;
      color: white;
      border-color: #7b1fa2;
      box-shadow: 0 0 5px rgba(156, 39, 176, 0.3);
    }

    .story-container {
      background: rgba(245, 240, 255, 0.8);
      border: 1px solid #9c27b0;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: inset 0 0 8px rgba(156, 39, 176, 0.1);
      position: relative;
      overflow: hidden;
    }

    .story-title {
      font-family: 'Playfair Display', serif;
      color: #7b1fa2;
      font-size: 1.6em;
      margin-bottom: 15px;
      text-shadow: 0 0 3px rgba(156, 39, 176, 0.2);
    }

    .story-text {
      color: #311b58;
      line-height: 1.5;
      margin-bottom: 15px;
      text-align: justify;
      font-size: 1.05em;
    }

    .story-image {
      width: 100%;
      max-width: 300px;
      height: auto;
      border-radius: 10px;
      margin: 10px auto;
      display: block;
      border: 2px solid #9c27b0;
      box-shadow: 0 0 8px rgba(156, 39, 176, 0.2);
    }

    .story-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      color: #5e35b1;
      font-size: 0.9em;
      border-top: 1px solid rgba(156, 39, 176, 0.2);
      padding-top: 10px;
    }

    .story-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn-story {
      flex: 1;
      padding: 8px 10px;
      border-radius: 12px;
      border: none;
      font-family: 'Caveat', cursive;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s ease;
      font-size: 1.05em;
    }

    .btn-submit {
      background: #9c27b0;
      color: white;
    }

    .btn-heart {
      background: rgba(244, 67, 54, 0.2);
      color: #f44336;
      border: 1px solid #f44336;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 5px;
    }

    .btn-heart:hover {
      background: rgba(244, 67, 54, 0.3);
      transform: scale(1.05);
    }

    .baba-message {
      background: rgba(232, 221, 247, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 12px;
      padding: 12px;
      margin: 10px 0;
      text-align: center;
      font-style: italic;
      color: #5e35b1;
      font-size: 0.95em;
    }

    .baba-humor {
      font-style: italic;
      color: #ff9800;
      margin-top: 8px;
      font-size: 0.95em;
    }

    .user-stats {
      display: flex;
      justify-content: space-around;
      background: rgba(232, 221, 247, 0.5);
      border-radius: 15px;
      padding: 10px;
      margin: 15px 0;
    }

    .stat-item {
      text-align: center;
    }

    .stat-value {
      font-size: 1.4em;
      font-weight: bold;
      color: #7b1fa2;
    }

    .stat-label {
      font-size: 0.85em;
      color: #5e35b1;
    }

    .story-parts {
      display: none;
      margin-top: 15px;
    }

    .story-part {
      background: rgba(245, 240, 255, 0.6);
      border: 1px solid #9c27b0;
      border-radius: 12px;
      padding: 12px;
      margin-bottom: 10px;
    }

    .part-title {
      font-weight: bold;
      color: #7b1fa2;
      margin-bottom: 5px;
    }

    .story-outcomes {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
      margin: 15px 0;
    }

    .outcome {
      background: rgba(232, 221, 247, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 12px;
      padding: 12px;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .outcome:hover {
      background: rgba(206, 181, 237, 0.6);
      transform: translateY(-2px);
    }

    .outcome.selected {
      background: rgba(156, 39, 176, 0.2);
      border-color: #7b1fa2;
      box-shadow: 0 0 5px rgba(156, 39, 176, 0.2);
    }

    .outcome-title {
      font-weight: bold;
      color: #7b1fa2;
      margin-bottom: 5px;
    }

    .submit-success {
      background: rgba(200, 230, 201, 0.4);
      border: 1px solid #4caf50;
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      color: #2e7d32;
    }

    .spell-container {
      background: rgba(225, 235, 245, 0.6);
      border: 1px solid #4a90e2;
      border-radius: 16px;
      padding: 20px;
      margin: 20px 0;
      box-shadow: inset 0 0 8px rgba(74, 144, 226, 0.2);
    }

    .spell-title {
      font-family: 'Playfair Display', serif;
      color: #1565c0;
      font-size: 1.5em;
      margin-bottom: 15px;
      text-align: center;
    }

    .spell-text {
      color: #0d47a1;
      line-height: 1.7;
      font-style: italic;
      margin-bottom: 15px;
      text-align: center;
      font-size: 1.1em;
    }

    .spell-desc {
      color: #1565c0;
      line-height: 1.5;
      text-align: justify;
    }

    .nav-buttons {
      margin: 20px auto 10px;
      display: flex;
      justify-content: space-between;
      max-width: 100%;
      flex-wrap: wrap;
      gap: 10px;
    }

    .btn-back, .btn-home, .btn-next, .btn-prev {
      display: inline-block;
      padding: 10px 15px;
      background: rgba(156, 39, 176, 0.15);
      color: #7b1fa2;
      text-decoration: none;
      border: 1px solid #9c27b0;
      border-radius: 10px;
      font-size: 1.05em;
      font-family: 'Caveat', cursive;
      transition: all 0.3s ease;
      box-shadow: 0 0 5px rgba(156, 39, 176, 0.1);
      min-width: 120px;
      flex: 1;
    }

    .btn-back:hover, .btn-home:hover, .btn-next:hover, .btn-prev:hover {
      background: rgba(156, 39, 176, 0.25);
      transform: scale(1.03);
      box-shadow: 0 0 8px rgba(156, 39, 176, 0.2);
    }

    .spiral {
      position: absolute;
      top: 5px;
      right: 5px;
      width: 40px;
      height: 40px;
      background: 
        radial-gradient(circle at 20px 20px, transparent 1.5px, #9c27b0 2px, transparent 2.5px),
        linear-gradient(45deg, transparent 20px, #9c27b0 21px, #9c27b0 22px, transparent 23px),
        linear-gradient(135deg, transparent 20px, #9c27b0 21px, #9c27b0 22px, transparent 23px);
      opacity: 0.1;
    }

    .seal {
      position: absolute;
      bottom: 5px;
      right: 5px;
      width: 30px;
      height: 30px;
      background: radial-gradient(circle, #9c27b0, #4a148c);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: bold;
      font-size: 0.6em;
      opacity: 0.4;
    }

    .page-transition {
      animation: pageSlide 0.4s ease;
    }

    @keyframes pageSlide {
      from { opacity: 0; transform: translateX(15px); }
      to { opacity: 1; transform: translateX(0); }
    }

    .story-animation {
      animation: storyAppear 0.6s ease;
    }

    @keyframes storyAppear {
      0% { opacity: 0; transform: scale(0.95); }
      100% { opacity: 1; transform: scale(1); }
    }

    .loading {
      display: none;
      text-align: center;
      padding: 15px;
    }

    .spinner {
      border: 3px solid rgba(156, 39, 176, 0.2);
      border-radius: 50%;
      border-top: 3px solid #9c27b0;
      width: 30px;
      height: 30px;
      animation: spin 1s linear infinite;
      margin: 0 auto 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .empty-message {
      background: rgba(232, 221, 247, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 12px;
      padding: 15px;
      margin: 15px 0;
      color: #5e35b1;
      font-size: 1.1em;
    }

    .user-stories {
      max-height: 400px;
      overflow-y: auto;
    }

    .user-story-item {
      background: rgba(232, 221, 247, 0.5);
      border: 1px solid #9c27b0;
      border-radius: 12px;
      padding: 12px;
      margin: 10px 0;
      cursor: pointer;
      transition: all 0.25s ease;
    }

    .user-story-item:hover {
      background: rgba(206, 181, 237, 0.6);
      transform: translateY(-2px);
    }

    .user-story-title {
      font-weight: bold;
      color: #7b1fa2;
      margin-bottom: 5px;
      display: flex;
      justify-content: space-between;
    }

    .user-story-stats {
      display: flex;
      gap: 15px;
      color: #5e35b1;
      font-size: 0.85em;
      margin-top: 5px;
    }

    .story-likes {
      display: flex;
      align-items: center;
      gap: 3px;
    }

    /* Mobile-specific styles */
    @media (max-width: 480px) {
      .container {
        padding: 15px 10px;
        border-radius: 16px;
      }
      
      h1 {
        font-size: 1.7em;
      }
      
      .input-field, .btn-story, .story-text {
        font-size: 1em;
      }
      
      .story-title {
        font-size: 1.4em;
      }
      
      .user-stats {
        flex-direction: column;
        gap: 8px;
      }
    }
  </style>
</head>
<body>
  <div class="stars" id="stars"></div>
  
  <div class="page">
    <div class="container">
      <h1>🌙 Расскажи свою тайну</h1>
      <p class="subtitle">Поделись своей историей с бабой Машей и другими пользователями</p>
      
      <div class="submenu">
        <div class="submenu-item active" onclick="showSection('submit-story')">Отправить историю</div>
        <div class="submenu-item" onclick="showSection('my-stories')">Мои истории</div>
        <div class="submenu-item" onclick="showSection('best-stories')">Лучшие истории</div>
      </div>
      
      <!-- Секция "Отправить историю" -->
      <div id="submit-story" class="section-content active">
        <div class="baba-message">
          "Дорогие мои внучата! Расскажите мне свою историю, а я подскажу, как ее оформить по-бабушкиному. 
          Помните: каждая история - это частичка души, так что делитесь искренне и от всего сердца!"
        </div>
        
        <div class="baba-humor" style="margin-bottom: 15px;">
          "А помните, как я вам говорила: 'Не суди по обложке, может, там внутри - счастье!'"
        </div>
        
        <div class="input-group">
          <label class="input-label">Название истории</label>
          <input type="text" class="input-field" id="story-title" placeholder="Как назвать вашу историю?">
        </div>
        
        <div class="input-group">
          <label class="input-label">Краткое описание</label>
          <input type="text" class="input-field" placeholder="О чем ваша история? (1-2 предложения)">
        </div>
        
        <div class="input-group">
          <label class="input-label">Основная часть истории</label>
          <textarea class="input-field textarea-field" id="story-main" placeholder="Напишите начало вашей истории..."></textarea>
        </div>
        
        <div class="story-parts" id="story-parts">
          <h3 style="color: #7b1fa2; text-align: left; margin: 15px 0 10px;">Три возможных исхода (будут сгенерированы автоматически):</h3>
          
          <div class="story-part">
            <div class="part-title">Исход №1 (Позитивный)</div>
            <div class="story-text" id="outcome-1" style="min-height: 80px; background: white; border-radius: 8px; padding: 10px; margin-top: 5px;">
              После того как вы нажмете "Отправить историю", здесь появится позитивный исход вашей истории.
            </div>
          </div>
          
          <div class="story-part">
            <div class="part-title">Исход №2 (Загадочный)</div>
            <div class="story-text" id="outcome-2" style="min-height: 80px; background: white; border-radius: 8px; padding: 10px; margin-top: 5px;">
              После того как вы нажмете "Отправить историю", здесь появится загадочный исход вашей истории.
            </div>
          </div>
          
          <div class="story-part">
            <div class="part-title">Исход №3 (Поучительный)</div>
            <div class="story-text" id="outcome-3" style="min-height: 80px; background: white; border-radius: 8px; padding: 10px; margin-top: 5px;">
              После того как вы нажмете "Отправить историю", здесь появится поучительный исход вашей истории.
            </div>
          </div>
        </div>
        
        <div class="input-group">
          <label class="input-label">Добавить изображение</label>
          <div style="display: flex; gap: 10px; margin-top: 8px;">
            <div class="avatar-container" style="width: 80px; height: 80px; margin: 0;">
              <img src="https://placehold.co/80x80/7b1fa2/ffffff?text=+" alt="Изображение" class="avatar" id="story-image-preview">
            </div>
            <div style="flex: 1; display: flex; align-items: center;">
              <input type="file" id="story-image" accept="image/*" style="display: none;" onchange="updateStoryImage(event)">
              <button class="btn-story btn-submit" style="width: 100%;" onclick="document.getElementById('story-image').click()">
                Выбрать изображение
              </button>
            </div>
          </div>
        </div>
        
        <button class="btn-story btn-submit" id="submit-story-btn" onclick="submitStory()">
          Отправить историю
        </button>
        
        <div class="baba-message" style="margin-top: 15px; background: rgba(232, 221, 247, 0.7);">
          <strong>Правила оформления историй:</strong><br>
          • История должна содержать не менее 500 символов<br>
          • Не используйте запрещенные слова и выражения<br>
          • Добавьте изображение, подходящее по теме<br>
          • Три исхода будут сгенерированы автоматически
        </div>
      </div>
      
      <!-- Секция "Мои истории" -->
      <div id="my-stories" class="section-content">
        <div class="user-stats">
          <div class="stat-item">
            <div class="stat-value" id="total-stories">3</div>
            <div class="stat-label">Историй</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="total-reads">42</div>
            <div class="stat-label">Прочитано</div>
          </div>
          <div class="stat-item">
            <div class="stat-value" id="total-likes">18</div>
            <div class="stat-label">❤️ Лайков</div>
          </div>
        </div>
        
        <div class="empty-message" id="my-stories-empty" style="display: none;">
          <p>Вы пока не отправили ни одной истории.</p>
          <p>Расскажите свою тайну и поделитесь ею с другими!</p>
        </div>
        
        <div class="user-stories" id="my-stories-list">
          <div class="user-story-item" onclick="viewStoryDetails(1)">
            <div class="user-story-title">
              <span>Тайна старого колодца</span>
              <span style="color: #f44336; font-size: 1.2em;">❤️</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец...
            </div>
            <div class="user-story-stats">
              <span>12 прочитано</span>
              <div class="story-likes">❤️ 5</div>
            </div>
          </div>
          
          <div class="user-story-item" onclick="viewStoryDetails(2)">
            <div class="user-story-title">
              <span>Дух леса и девочка</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              Однажды маленькая девочка по имени Аня заблудилась в лесу и встретила странное существо...
            </div>
            <div class="user-story-stats">
              <span>18 прочитано</span>
              <div class="story-likes">❤️ 8</div>
            </div>
          </div>
          
          <div class="user-story-item" onclick="viewStoryDetails(3)">
            <div class="user-story-title">
              <span>Зачарованный медальон</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              Старый медальон, доставшийся в наследство, оказался не простым украшением, а магическим артефактом...
            </div>
            <div class="user-story-stats">
              <span>12 прочитано</span>
              <div class="story-likes">❤️ 5</div>
            </div>
          </div>
        </div>
        
        <div class="baba-message" id="baba-stats-message">
          "Ох, внучата! Вижу, что ваши истории набирают популярность! 
          Уже 42 человека прочитали ваши рассказы, и 18 раз поставили сердечко. 
          Молодцы, продолжайте в том же духе!"
        </div>
      </div>
      
      <!-- Секция "Лучшие истории" -->
      <div id="best-stories" class="section-content">
        <div class="baba-message">
          "Вот подборка самых интересных историй от моих любимых внучат! 
          Эти истории настолько хороши, что я обязательно запишу их в свою книгу мудрости."
        </div>
        
        <div class="empty-message" id="best-stories-empty" style="display: none;">
          <p>Пока нет опубликованных историй.</p>
          <p>Станьте первым, кто поделится своей историей!</p>
        </div>
        
        <div class="user-stories" id="best-stories-list">
          <div class="user-story-item" onclick="viewBestStory(1)">
            <div class="user-story-title">
              <span>Тайна старого колодца</span>
              <span style="color: #f44336; font-size: 1.2em;">❤️</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец...
            </div>
            <div class="user-story-stats">
              <span>Анна • Москва</span>
              <div class="story-likes">❤️ 24</div>
            </div>
          </div>
          
          <div class="user-story-item" onclick="viewBestStory(2)">
            <div class="user-story-title">
              <span>Дух реки и ее тайны</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              Каждую полнолуние река начинала светиться, и местные жители слышали странные звуки...
            </div>
            <div class="user-story-stats">
              <span>Михаил • Санкт-Петербург</span>
              <div class="story-likes">❤️ 19</div>
            </div>
          </div>
          
          <div class="user-story-item" onclick="viewBestStory(3)">
            <div class="user-story-title">
              <span>Ведьмин цветок</span>
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              В лесу рос цветок, который распускался только раз в году, в ночь на Ивана Купалу...
            </div>
            <div class="user-story-stats">
              <span>София • Казань</span>
              <div class="story-likes">❤️ 15</div>
            </div>
          </div>
        </div>
        
        <div class="baba-message" style="margin-top: 15px;">
          "Смотрите, как много прекрасных историй! 
          Баба Маша каждую неделю выбирает лучшие рассказы и добавляет их в историю дня. 
          Может, именно ваша история станет следующей?"
        </div>
      </div>
      
      <!-- Детали истории -->
      <div id="story-details" class="section-content" style="display: none;">
        <div class="story-container">
          <h2 class="story-title" id="detail-story-title">Тайна старого колодца</h2>
          
          <img src="https://placehold.co/300x200/7b1fa2/ffffff?text=Старый+колодец" alt="Старый колодец" class="story-image" id="detail-story-image">
          
          <p class="story-text" id="detail-story-main">
            В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец. Ему было не меньше ста лет, а может, и больше. Местные жители давно перестали его использовать, ведь рядом с колодцем появился новый водопровод. Но бабушка Агния, самая старая жительница деревни, каждый вечер подходила к колодцу и что-то шептала, бросая в темную бездну горсть пшена.
          </p>
          
          <h3 style="color: #7b1fa2; text-align: left; margin: 20px 0 10px;">Выберите, как может закончиться эта история:</h3>
          
          <div class="story-outcomes">
            <div class="outcome" onclick="selectOutcome(this, 1)">
              <div class="outcome-title">Помочь духу воды вернуть доверие людей</div>
              <p style="color: #311b58; font-size: 0.95em; margin: 5px 0;">Лиза и ее друзья решили помочь духу воды создать новый оберег для деревни...</p>
            </div>
            
            <div class="outcome" onclick="selectOutcome(this, 2)">
              <div class="outcome-title">Рассказать всем о колодце и духе</div>
              <p style="color: #311b58; font-size: 0.95em; margin: 5px 0;">Лиза решила рассказать всем о колодце и духе. На следующий день она побежала в школу...</p>
            </div>
            
            <div class="outcome" onclick="selectOutcome(this, 3)">
              <div class="outcome-title">Остаться с бабушкой Агнией и учиться общаться с духами</div>
              <p style="color: #311b58; font-size: 0.95em; margin: 5px 0;">Лиза решила остаться с бабушкой Агнией и учиться общаться с духами. Бабушка одобрительно кивнула...</p>
            </div>
          </div>
          
          <div class="story-footer">
            <span>Автор: Анна • Москва</span>
            <div class="story-actions">
              <button class="btn-story btn-heart" onclick="likeStory()">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                  <path d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01L8 2.748zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143c.06.055.119.112.176.171a3.12 3.12 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15z"/>
                </svg>
                <span id="likes-count">5</span>
              </button>
            </div>
          </div>
        </div>
        
        <div class="spell-container">
          <h3 class="spell-title">Заговор от неприятностей</h3>
          <p class="spell-text">"Встану я рано, помолюсь, перекрещусь, выйду из дверей, из ворот в чисто поле. В чистом поле стоит дуб, а под дубом камень-алатырь. На камне-алатыре сидит белый голубь, а в клюве у него святая вода. Святая вода умывает, омывает, очищает от всякого зла, от сглаза, от порчи, от колдовства. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.</p>
        </div>
        
        <div class="baba-message">
          "Ох, какая замечательная история! Обязательно запишу ее в свою книгу мудрости. 
          Такие рассказы помогают людям понять, что в мире еще остается место для чудес и веры."
        </div>
        
        <div class="baba-humor" style="margin: 15px 0;">
          "А помните, как я вам говорила: 'Не суди по обложке, может, там внутри - счастье!'"
        </div>
      </div>
      
      <!-- Успешная отправка -->
      <div id="story-submitted" class="section-content" style="display: none;">
        <div class="submit-success">
          <h2 style="color: #2e7d32; margin-bottom: 10px;">История успешно отправлена!</h2>
          <p>Ваша история отправлена на проверку бабе Маше. 
             Скоро она появится в разделе "Мои истории" и может быть опубликована в "Истории дня".</p>
        </div>
        
        <div class="story-container">
          <h2 class="story-title" id="submitted-story-title">Тайна старого колодца</h2>
          
          <img src="https://placehold.co/300x200/7b1fa2/ffffff?text=Старый+колодец" alt="Старый колодец" class="story-image" id="submitted-story-image">
          
          <p class="story-text" id="submitted-story-main">
            В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец. Ему было не меньше ста лет, а может, и больше. Местные жители давно перестали его использовать, ведь рядом с колодцем появился новый водопровод. Но бабушка Агния, самая старая жительница деревни, каждый вечер подходила к колодцу и что-то шептала, бросая в темную бездну горсть пшена.
          </p>
        </div>
        
        <div class="spell-container">
          <h3 class="spell-title">Заговор от неприятностей</h3>
          <p class="spell-text">"Встану я рано, помолюсь, перекрещусь, выйду из дверей, из ворот в чисто поле. В чистом поле стоит дуб, а под дубом камень-алатырь. На камне-алатыре сидит белый голубь, а в клюве у него святая вода. Святая вода умывает, омывает, очищает от всякого зла, от сглаза, от порчи, от колдовства. Да будет так. Аминь."</p>
          <p class="spell-desc">Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.</p>
        </div>
        
        <div class="baba-message" style="margin-top: 15px;">
          "Ох, внучата! Какая чудесная история! Обязательно запишу ее в свою книгу мудрости. 
          Эта история такая поучительная, что я непременно включу ее в историю дня!"
        </div>
        
        <div class="baba-humor" style="margin: 15px 0;">
          "А помните, как я вам говорила: 'Не суди по обложке, может, там внутри - счастье!' 
          Вы - молодец, продолжайте творить и делиться своими историями!" 
        </div>
        
        <button class="btn-story btn-submit" onclick="showSection('my-stories')">
          Перейти к моим историям
        </button>
      </div>

      <div class="nav-buttons">
        <a href="#" class="btn-back" onclick="goBack()" style="display: none;">⬅️ Назад</a>
        <a href="index.html" class="btn-home">🏠 Главное меню</a>
      </div>
    </div>
  </div>

  <script>
    // Создаем мерцающие звезды
    function createStars() {
      const starsContainer = document.getElementById('stars');
      const starCount = 60;
      
      for (let i = 0; i < starCount; i++) {
        const star = document.createElement('div');
        star.classList.add('star');
        
        // Случайные параметры для звезд
        const size = Math.random() * 2;
        const posX = Math.random() * 100;
        const posY = Math.random() * 100;
        const delay = Math.random() * 3;
        const duration = 2 + Math.random() * 3;
        
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.left = `${posX}%`;
        star.style.top = `${posY}%`;
        star.style.animationDelay = `${delay}s`;
        star.style.animationDuration = `${duration}s`;
        
        starsContainer.appendChild(star);
      }
    }
    
    // Данные пользователя
    let userData = {
      id: 'user_12345',
      avatar: 'https://placehold.co/100x100/7b1fa2/ffffff?text=А',
      username: 'Анна',
      city: 'Москва',
      stories: [
        {
          id: 1,
          title: 'Тайна старого колодца',
          description: 'История о духе воды и забытом колодце',
          content: 'В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец. Ему было не меньше ста лет, а может, и больше. Местные жители давно перестали его использовать, ведь рядом с колодцем появился новый водопровод. Но бабушка Агния, самая старая жительница деревни, каждый вечер подходила к колодцу и что-то шептала, бросая в темную бездну горсть пшена.',
          outcomes: [
            'Лиза и ее друзья решили помочь духу воды создать новый оберег для деревни. Бабушка Агния одобрительно кивнула и сказала: "Хороший выбор, девочка. Но это непросто. Люди перестали верить в чудеса, потому что сами перестали их замечать." На следующий день Лиза собрала своих друзей и рассказала им о колодце. Сначала ребята смеялись, но когда Лиза привела их к колодцу и они услышали музыку, все замолчали. "Что нам делать?" - спросил самый смелый мальчик по имени Петя. "Нужно вернуть колодцу его значение", - ответила Лиза. Через неделю к колодцу начали приходить взрослые. А по вечерам, когда солнце садилось за лес, из колодца доносилась тихая музыка, и казалось, будто сама природа радуется, что люди вновь обрели связь с ней.',
            'Лиза решила рассказать всем о колодце и духе. На следующий день она побежала в школу и стала рассказывать одноклассникам о том, что видела. "Вы не поверите! В старом колодце живет дух воды, который играет на гармони!" - воскликнула она. Ребята засмеялись. Но Лиза не сдавалась. Она привела одноклассников к колодцу после уроков. Все собрались вокруг, заглядывая в темную бездну. Но дух не появился. Не было ни музыки, ни голоса. Только тишина и темнота. Ребята посмеялись над Лизой и ушли. На следующий день Лиза снова пришла к колодцу. Бабушка Агния уже ждала ее. "Не нужно спешить, девочка, - сказала она. - Духи не любят, когда их выставляют напоказ." Лиза поняла, что поступила неправильно. Она решила больше никому не рассказывать о колодце, пока не научится правильно общаться с духом.',
            'Лиза решила остаться с бабушкой Агнией и учиться общаться с духами. Бабушка одобрительно кивнула. "Хороший выбор, девочка, - сказала она. - Но путь этот непростой. Ты готова учиться?" "Да", - уверенно ответила Лиза. С тех пор каждое утро Лиза приходила к бабушке Агнии. Сначала она училась чувствовать энергию природы, определять, где находится вода под землей, как разговаривать с деревьями и животными. Через месяц Лиза впервые услышала, как деревья шепчутся между собой. Еще через неделю она научилась видеть ауры живых существ. А через два месяца дух воды из колодца сам пришел к ней во сне. "Ты готова, - сказал он. - Теперь ты можешь стать хранителем этого места." Лиза поняла, что выбрала свой путь. Она будет учиться у бабушки Агнии, чтобы однажды сама стать хранительницей мудрости и передать свои знания следующему поколению.'
          ],
          spell: {
            title: 'Заговор от неприятностей',
            text: '"Встану я рано, помолюсь, перекрещусь, выйду из дверей, из ворот в чисто поле. В чистом поле стоит дуб, а под дубом камень-алатырь. На камне-алатыре сидит белый голубь, а в клюве у него святая вода. Святая вода умывает, омывает, очищает от всякого зла, от сглаза, от порчи, от колдовства. Да будет так. Аминь."',
            description: 'Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.'
          },
          image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Старый+колодец',
          reads: 12,
          likes: 5
        },
        {
          id: 2,
          title: 'Дух леса и девочка',
          description: 'Приключение в лесу с мистическим существом',
          content: 'Однажды маленькая девочка по имени Аня заблудилась в лесу и встретила странное существо...',
          outcomes: [
            'Аня подружилась с духом леса и стала его хранительницей...',
            'Дух леса помог Ане найти дорогу домой, но попросил сохранить тайну...',
            'Аня рассказала о духе леса старосте деревни, и все начали уважать лес больше...'
          ],
          spell: {
            title: 'Заговор на гармонию с природой',
            text: '"Деревья мои братья, травы мои сестры, ветер мой друг, вода моя мать. Поделитесь со мной своей мудростью, научите слышать шепот природы. Пусть моя душа будет чиста, как ручей, а сердце спокойно, как озеро в безветренный день. Да будет так. Аминь."',
            description: 'Этот заговор помогает установить связь с природой и ее духами. Произносить его нужно в лесу или у воды, держа в руках ветку дерева или горсть земли. Эффект усиливается в полнолуние.'
          },
          image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Дух+леса',
          reads: 18,
          likes: 8
        },
        {
          id: 3,
          title: 'Зачарованный медальон',
          description: 'Наследство с необычными свойствами',
          content: 'Старый медальон, доставшийся в наследство, оказался не простым украшением, а магическим артефактом...',
          outcomes: [
            'Медальон помог обнаружить семейную тайну и спасти деревню от беды...',
            'Медальон оказался проклятым, и его пришлось вернуть в древнее святилище...',
            'Медальон научил владельца слышать голоса предков и обрести мудрость...'
          ],
          spell: {
            title: 'Заговор на освобождение от чар',
            text: '"Светлый ангел, приди ко мне, сними чары, разреши узы. Как ключ к замку подходит, так и этот заговор ко мне пригодится. Как вода течет, так и чары с меня сойдут. Как огонь пылает, так и я от зла избавляюсь. Да будет так. Аминь."',
            description: 'Этот заговор используется для снятия негативного воздействия и колдовства. Произносить его нужно утром, держа в руках зажженную церковную свечу. После прочтения свечу следует потушить и сохранить до следующего утра.'
          },
          image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Медальон',
          reads: 12,
          likes: 5
        }
      ]
    };
    
    // Лучшие истории
    const bestStories = [
      {
        id: 1,
        title: 'Тайна старого колодца',
        description: 'История о духе воды и забытом колодце',
        content: 'В небольшой деревушке под названием Заречье, затерянной среди густых лесов и полей, стоял старый колодец...',
        author: 'Анна',
        city: 'Москва',
        image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Старый+колодец',
        reads: 24,
        likes: 24
      },
      {
        id: 2,
        title: 'Дух реки и ее тайны',
        description: 'Каждую полнолуние река начинала светиться',
        content: 'Каждую полнолуние река начинала светиться, и местные жители слышали странные звуки...',
        author: 'Михаил',
        city: 'Санкт-Петербург',
        image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Дух+реки',
        reads: 19,
        likes: 19
      },
      {
        id: 3,
        title: 'Ведьмин цветок',
        description: 'Цветок, распускающийся раз в году',
        content: 'В лесу рос цветок, который распускался только раз в году, в ночь на Ивана Купалу...',
        author: 'София',
        city: 'Казань',
        image: 'https://placehold.co/300x200/7b1fa2/ffffff?text=Ведьмин+цветок',
        reads: 15,
        likes: 15
      }
    ];
    
    // Текущая секция
    let currentSection = 'submit-story';
    let currentStory = null;
    let selectedOutcome = null;
    
    // Функция для отображения секции
    function showSection(section) {
      // Скрываем все секции
      document.querySelectorAll('.section-content').forEach(el => {
        el.classList.remove('active');
        el.style.display = 'none';
      });
      
      // Показываем выбранную секцию
      const sectionElement = document.getElementById(section);
      sectionElement.style.display = 'block';
      sectionElement.classList.add('active');
      
      // Обновляем активный пункт меню
      document.querySelectorAll('.submenu-item').forEach(el => {
        el.classList.remove('active');
      });
      event?.currentTarget?.classList.add('active');
      
      currentSection = section;
      
      // Показываем кнопку "Назад"
      document.querySelector('.btn-back').style.display = 'inline-block';
      
      // Обновляем статистику в разделе "Мои истории"
      if (section === 'my-stories') {
        updateMyStoriesStats();
        renderMyStories();
      }
      
      // Обновляем лучшие истории
      if (section === 'best-stories') {
        renderBestStories();
      }
    }
    
    // Функция обновления статистики в разделе "Мои истории"
    function updateMyStoriesStats() {
      let totalReads = 0;
      let totalLikes = 0;
      
      userData.stories.forEach(story => {
        totalReads += story.reads;
        totalLikes += story.likes;
      });
      
      document.getElementById('total-stories').textContent = userData.stories.length;
      document.getElementById('total-reads').textContent = totalReads;
      document.getElementById('total-likes').textContent = totalLikes;
      
      // Обновляем сообщение бабы Маши
      const babaMessage = document.getElementById('baba-stats-message');
      babaMessage.innerHTML = `
        "Ох, внучата! Вижу, что ваши истории набирают популярность! 
        Уже ${totalReads} человек прочитали ваши рассказы, и ${totalLikes} раз поставили сердечко. 
        Молодцы, продолжайте в том же духе!"
      `;
    }
    
    // Функция отображения моих историй
    function renderMyStories() {
      const storiesList = document.getElementById('my-stories-list');
      const emptyMessage = document.getElementById('my-stories-empty');
      
      if (userData.stories.length === 0) {
        storiesList.style.display = 'none';
        emptyMessage.style.display = 'block';
      } else {
        storiesList.style.display = 'block';
        emptyMessage.style.display = 'none';
        
        // Очищаем список
        storiesList.innerHTML = '';
        
        // Добавляем истории
        userData.stories.forEach(story => {
          const storyElement = document.createElement('div');
          storyElement.className = 'user-story-item';
          storyElement.onclick = function() { viewStoryDetails(story.id); };
          
          storyElement.innerHTML = `
            <div class="user-story-title">
              <span>${story.title}</span>
              ${story.likes > 0 ? '<span style="color: #f44336; font-size: 1.2em;">❤️</span>' : ''}
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              ${story.content.substring(0, 100)}...
            </div>
            <div class="user-story-stats">
              <span>${story.reads} прочитано</span>
              <div class="story-likes">❤️ ${story.likes}</div>
            </div>
          `;
          
          storiesList.appendChild(storyElement);
        });
      }
    }
    
    // Функция отображения лучших историй
    function renderBestStories() {
      const storiesList = document.getElementById('best-stories-list');
      const emptyMessage = document.getElementById('best-stories-empty');
      
      if (bestStories.length === 0) {
        storiesList.style.display = 'none';
        emptyMessage.style.display = 'block';
      } else {
        storiesList.style.display = 'block';
        emptyMessage.style.display = 'none';
        
        // Очищаем список
        storiesList.innerHTML = '';
        
        // Добавляем истории
        bestStories.forEach(story => {
          const storyElement = document.createElement('div');
          storyElement.className = 'user-story-item';
          storyElement.onclick = function() { viewBestStory(story.id); };
          
          storyElement.innerHTML = `
            <div class="user-story-title">
              <span>${story.title}</span>
              ${story.likes > 0 ? '<span style="color: #f44336; font-size: 1.2em;">❤️</span>' : ''}
            </div>
            <div class="story-text" style="margin: 5px 0; font-size: 0.95em; text-align: left;">
              ${story.content.substring(0, 100)}...
            </div>
            <div class="user-story-stats">
              <span>${story.author} • ${story.city}</span>
              <div class="story-likes">❤️ ${story.likes}</div>
            </div>
          `;
          
          storiesList.appendChild(storyElement);
        });
      }
    }
    
    // Функция просмотра деталей своей истории
    function viewStoryDetails(storyId) {
      const story = userData.stories.find(s => s.id === storyId);
      if (!story) return;
      
      currentStory = story;
      
      // Обновляем данные
      document.getElementById('detail-story-title').textContent = story.title;
      document.getElementById('detail-story-image').src = story.image;
      document.getElementById('detail-story-main').textContent = story.content;
      document.getElementById('likes-count').textContent = story.likes;
      
      // Обновляем заговор
      const spellContainer = document.querySelector('#story-details .spell-container');
      if (spellContainer && story.spell) {
        spellContainer.innerHTML = `
          <h3 class="spell-title">${story.spell.title}</h3>
          <p class="spell-text">${story.spell.text}</p>
          <p class="spell-desc">${story.spell.description}</p>
        `;
      }
      
      // Показываем секцию
      showSection('story-details');
    }
    
    // Функция просмотра лучшей истории
    function viewBestStory(storyId) {
      const story = bestStories.find(s => s.id === storyId);
      if (!story) return;
      
      // Создаем временную историю с заговором для просмотра
      currentStory = {
        id: story.id,
        title: story.title,
        content: story.content,
        image: story.image,
        likes: story.likes,
        spell: {
          title: 'Заговор от неприятностей',
          text: '"Встану я рано, помолюсь, перекрещусь, выйду из дверей, из ворот в чисто поле. В чистом поле стоит дуб, а под дубом камень-алатырь. На камне-алатыре сидит белый голубь, а в клюве у него святая вода. Святая вода умывает, омывает, очищает от всякого зла, от сглаза, от порчи, от колдовства. Да будет так. Аминь."',
          description: 'Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.'
        }
      };
      
      // Обновляем данные
      document.getElementById('detail-story-title').textContent = story.title;
      document.getElementById('detail-story-image').src = story.image;
      document.getElementById('detail-story-main').textContent = story.content;
      document.getElementById('likes-count').textContent = story.likes;
      
      // Обновляем заговор
      const spellContainer = document.querySelector('#story-details .spell-container');
      if (spellContainer) {
        spellContainer.innerHTML = `
          <h3 class="spell-title">${currentStory.spell.title}</h3>
          <p class="spell-text">${currentStory.spell.text}</p>
          <p class="spell-desc">${currentStory.spell.description}</p>
        `;
      }
      
      // Показываем секцию
      showSection('story-details');
    }
    
    // Функция выбора исхода
    function selectOutcome(element, outcomeIndex) {
      // Снимаем выделение с других исходов
      document.querySelectorAll('.outcome').forEach(outcome => {
        outcome.classList.remove('selected');
      });
      
      // Выделяем выбранный исход
      element.classList.add('selected');
      
      selectedOutcome = outcomeIndex;
      
      // В реальной системе здесь было бы сохранение выбора
      console.log(`Выбран исход ${outcomeIndex} для истории ${currentStory.id}`);
    }
    
    // Функция обновления превью изображения
    function updateStoryImage(event) {
      const file = event.target.files[0];
      if (file) {
        const reader = new FileReader();
        
        reader.onload = function(e) {
          document.getElementById('story-image-preview').src = e.target.result;
        }
        
        reader.readAsDataURL(file);
      }
    }
    
    // Функция автоматической генерации исходов
    function generateOutcomes(storyContent) {
      // В реальной системе здесь был бы сложный алгоритм генерации
      // Для демонстрации используем простые шаблоны
      
      const themes = [
        "старый колодец", "дух леса", "ведьмин цветок", "зачарованный медальон",
        "таинственный замок", "лунная поляна", "река снов", "лесной оберег"
      ];
      
      const actions = [
        "исследовала", "обнаружила", "столкнулась", "раскрыла", "помогла",
        "спасла", "преодолела", "нашла", "расколдовала", "превратила"
      ];
      
      const endings = [
        "злой колдунье", "проклятию", "темным силам", "беде", "опасности",
        "бедствию", "беде", "злу", "напасти", "бедствию"
      ];
      
      // Определяем тему на основе содержимого
      let themeIndex = 0;
      if (storyContent.toLowerCase().includes("колодец")) themeIndex = 0;
      else if (storyContent.toLowerCase().includes("лес")) themeIndex = 1;
      else if (storyContent.toLowerCase().includes("цветок")) themeIndex = 2;
      else if (storyContent.toLowerCase().includes("медальон")) themeIndex = 3;
      else themeIndex = Math.floor(Math.random() * themes.length);
      
      // Генерируем исходы
      const positiveOutcome = generatePositiveOutcome(themes[themeIndex], actions, endings);
      const mysteriousOutcome = generateMysteriousOutcome(themes[themeIndex], actions, endings);
      const instructiveOutcome = generateInstructiveOutcome(themes[themeIndex], actions, endings);
      
      return [positiveOutcome, mysteriousOutcome, instructiveOutcome];
    }
    
    // Функция генерации позитивного исхода
    function generatePositiveOutcome(theme, actions, endings) {
      const actionIndex = Math.floor(Math.random() * actions.length);
      const endingIndex = Math.floor(Math.random() * endings.length);
      
      return `В конце концов, героиня ${actions[actionIndex]} ${theme} и избавилась от ${endings[endingIndex]}. 
      Все жители деревни были счастливы, и с тех пор в их жизни воцарились мир и гармония. 
      Даже бабушка Агния, самая мудрая женщина в округе, сказала: "Вот видите, как важно верить в чудеса!" 
      С тех пор каждый вечер у колодца собиралась вся деревня, чтобы послушать истории и насладиться спокойствием.`;
    }
    
    // Функция генерации загадочного исхода
    function generateMysteriousOutcome(theme, actions, endings) {
      const actionIndex = (Math.floor(Math.random() * actions.length) + 1) % actions.length;
      const endingIndex = (Math.floor(Math.random() * endings.length) + 2) % endings.length;
      
      return `Когда казалось, что все потеряно, произошло неожиданное чудо. 
      Героиня ${actions[actionIndex]} ${theme}, но ${endings[endingIndex]} не исчезло полностью. 
      Вместо этого оно трансформировалось в нечто новое и таинственное. 
      Теперь по ночам в лесу можно услышать странные звуки, а в полнолуние над колодцем появляется светящаяся фигура. 
      Никто не знает, что это значит, но все чувствуют: магия все еще живет среди нас.`;
    }
    
    // Функция генерации поучительного исхода
    function generateInstructiveOutcome(theme, actions, endings) {
      const actionIndex = (Math.floor(Math.random() * actions.length) + 2) % actions.length;
      const endingIndex = (Math.floor(Math.random() * endings.length) + 3) % endings.length;
      
      return `Этот опыт научил героиню важному уроку: нельзя судить о вещах поверхностно. 
      Пройдя через трудности, она ${actions[actionIndex]} ${theme} и поняла, что ${endings[endingIndex]} было лишь испытанием на пути к мудрости. 
      Теперь она делится своими знаниями с другими, помогая им видеть мир глубже и понимать, что за обыденным фасадом часто скрываются удивительные тайны. 
      Как говорит бабушка Агния: "Не суди по обложке, может, там внутри - счастье!"`;
    }
    
    // Функция генерации заговора
    function generateSpell(theme) {
      const spellThemes = [
        "от сглаза", "на удачу", "на здоровье", "на гармонию", "на освобождение от чар"
      ];
      
      const selectedTheme = spellThemes[Math.floor(Math.random() * spellThemes.length)];
      
      let title, text, description;
      
      if (selectedTheme === "от сглаза") {
        title = "Заговор от сглаза";
        text = `"Как солнце встает, так и дела мои растут. Как месяц полнится, так и удача ко мне прибывает. Как звезды ярко светят, так и путь мой освещают. Да будет так. Аминь."`;
        description = "Этот заговор помогает защититься от негативной энергии и сглаза. Произносить его нужно утром, набрав в ладони святой воды и умываясь ею. Повторять трижды в течение недели для усиления эффекта.";
      } else if (selectedTheme === "на удачу") {
        title = "Заговор на удачу в делах";
        text = `"Как солнце встает, так и дела мои растут. Как месяц полнится, так и удача ко мне прибывает. Как звезды ярко светят, так и путь мой освещают. Да будет так. Аминь."`;
        description = "Произносить этот заговор нужно перед важным делом или в начале рабочего дня. Представляйте, как солнечный свет наполняет вас энергией и уверенностью. Можно добавить в заговор свое имя для персонального эффекта.";
      } else if (selectedTheme === "на здоровье") {
        title = "Заговор на здоровье";
        text = `"Матушка-земля, отец-небо, братья-ветры, сестры-реки, помогите, исцелите, здоровье верните. Как трава после дождя расцветает, так и я здоровьем обрасту. Как солнце светит ярко, так и силы мои крепнут. Да будет так. Аминь."`;
        description = "Этот заговор особенно эффективен при первых признаках недомогания. Произносить его лучше на рассвете, держа в руках траву или цветок. Можно использовать как профилактику каждую весну и осень.";
      } else if (selectedTheme === "на гармонию") {
        title = "Заговор на гармонию с природой";
        text = `"Деревья мои братья, травы мои сестры, ветер мой друг, вода моя мать. Поделитесь со мной своей мудростью, научите слышать шепот природы. Пусть моя душа будет чиста, как ручей, а сердце спокойно, как озеро в безветренный день. Да будет так. Аминь."`;
        description = "Этот заговор помогает установить связь с природой и ее духами. Произносить его нужно в лесу или у воды, держа в руках ветку дерева или горсть земли. Эффект усиливается в полнолуние.";
      } else {
        title = "Заговор на освобождение от чар";
        text = `"Светлый ангел, приди ко мне, сними чары, разреши узы. Как ключ к замку подходит, так и этот заговор ко мне пригодится. Как вода течет, так и чары с меня сойдут. Как огонь пылает, так и я от зла избавляюсь. Да будет так. Аминь."`;
        description = "Этот заговор используется для снятия негативного воздействия и колдовства. Произносить его нужно утром, держа в руках зажженную церковную свечу. После прочтения свечу следует потушить и сохранить до следующего утра.";
      }
      
      return {
        title: title,
        text: text,
        description: description
      };
    }
    
    // Функция отправки истории
    function submitStory() {
      const title = document.getElementById('story-title').value.trim();
      const mainContent = document.getElementById('story-main').value.trim();
      
      if (!title || title.length < 5) {
        alert('Пожалуйста, введите название истории (минимум 5 символов)');
        return;
      }
      
      if (!mainContent || mainContent.length < 500) {
        alert('Основная часть истории должна содержать не менее 500 символов');
        return;
      }
      
      // Генерируем исходы
      const outcomes = generateOutcomes(mainContent);
      
      // Генерируем заговор
      const spell = generateSpell(title);
      
      // Создаем новую историю
      const newStory = {
        id: Date.now(),
        title: title,
        description: 'Описание истории',
        content: mainContent,
        outcomes: outcomes,
        spell: spell,
        image: document.getElementById('story-image-preview').src,
        reads: 0,
        likes: 0
      };
      
      // Добавляем в список пользователя
      userData.stories.unshift(newStory);
      
      // Обновляем данные в разделе успешной отправки
      document.getElementById('submitted-story-title').textContent = newStory.title;
      document.getElementById('submitted-story-image').src = newStory.image;
      document.getElementById('submitted-story-main').textContent = newStory.content.substring(0, 200) + '...';
      
      // Обновляем заговор
      const spellContainer = document.querySelector('#story-submitted .spell-container');
      if (spellContainer) {
        spellContainer.innerHTML = `
          <h3 class="spell-title">${spell.title}</h3>
          <p class="spell-text">${spell.text}</p>
          <p class="spell-desc">${spell.description}</p>
        `;
      }
      
      // Показываем раздел успешной отправки
      showSection('story-submitted');
    }
    
    // Функция лайка истории
    function likeStory() {
      if (!currentStory) return;
      
      // Увеличиваем количество лайков
      currentStory.likes = (currentStory.likes || 0) + 1;
      
      // Обновляем отображение
      document.getElementById('likes-count').textContent = currentStory.likes;
      
      // В реальной системе здесь было бы отправка лайка на сервер
      
      // Показываем сообщение о лайке
      const heartBtn = document.querySelector('.btn-heart');
      heartBtn.style.transform = 'scale(1.2)';
      
      setTimeout(() => {
        heartBtn.style.transform = 'scale(1)';
        
        // Показываем благодарность от бабы Маши
        const babaMessage = document.querySelector('.baba-message');
        babaMessage.innerHTML = `
          "Ох, внучата! Какая чудесная история! Обязательно запишу ее в свою книгу мудрости. 
          Такие рассказы помогают людям понять, что в мире еще остается место для чудес и веры."
        `;
      }, 300);
    }
    
    // Функция для возврата назад
    function goBack() {
      if (currentSection === 'story-details') {
        if (document.getElementById('submit-story').style.display === 'block') {
          showSection('submit-story');
        } else if (document.getElementById('my-stories').style.display === 'block') {
          showSection('my-stories');
        } else {
          showSection('best-stories');
        }
      } else if (currentSection === 'story-submitted') {
        showSection('submit-story');
      } else {
        showSection('submit-story');
      }
      
      // Скрываем кнопку "Назад", если вернулись на начальный экран
      if (currentSection === 'submit-story') {
        document.querySelector('.btn-back').style.display = 'none';
      }
    }
    
    // Функция для инициализации приложения
    function initApp() {
      createStars();
      
      // Проверяем, есть ли истории
      if (userData.stories.length > 0) {
        updateMyStoriesStats();
      }
      
      // Показываем инструкцию по навигации
      setTimeout(() => {
        document.querySelector('.btn-back').style.display = 'none';
      }, 500);
    }
    
    // Инициализация при загрузке страницы
    window.onload = initApp;
  </script>
</body>
</html>